var Te=Object.defineProperty,Ne=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var ye=(e,t,n)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fe=(e,t)=>{for(var n in t||(t={}))Ze.call(t,n)&&ye(e,n,t[n]);if($e)for(var n of $e(t))qe.call(t,n)&&ye(e,n,t[n]);return e},Ie=(e,t)=>Ne(e,Ye(t));var le=(e,t,n)=>new Promise((d,v)=>{var _=c=>{try{o(n.next(c))}catch(p){v(p)}},i=c=>{try{o(n.throw(c))}catch(p){v(p)}},o=c=>c.done?d(c.value):Promise.resolve(c.value).then(_,i);o((n=n.apply(e,t)).next())});import"./vue.bba2ec4d.js";import{d as W}from"./dayjs.3e893def.js";import{l as x}from"./lodash.20dab116.js";import{i as J,c as ee,f as Se,_ as K,h as ne,s as Le}from"./index.17c23084.js";import{d as H,e as j,f as G,m as S,h as q,_ as s,v as re,$ as C,a2 as Y,a3 as u,c as a,a1 as l,E as m,ac as U,a0 as V,t as ce,F as X,a8 as te,af as Q,aa as Fe,ab as be,a4 as oe,r as _e,s as je,w as Ce,H as Je,L as Ke,b as He,X as we,k as Ge,x as Qe,n as We,Q as Xe,p as he,ak as xe,N as et,B as Ae,a5 as tt,al as at}from"./@vue.ce69bcce.js";import{T as ge,P as lt}from"./@ant-design.dce0d0de.js";import{O as de,i as pe,r as me,d as ke}from"./index.87bcc442.js";const nt=H({name:"MachineItem",emits:["update:itemValue","itemDel","itemBrandValueChange","itemShowProductList","itemChecked"],props:{itemValue:{type:Object,default:()=>({})}},components:{},setup(e,{emit:t,attrs:n}){const d=j("context"),v=G({get(){return e.itemValue},set(f){t("update:itemValue",f)}}),_=G(()=>Number(n.index)+1),i=()=>{t("itemDel",n.index)},o=(f,M)=>{const y={b_all_path:"",b_id:null,b_name:""};J(f)||(y.b_all_path=f.join("-"),y.b_id=f[f.length-1],y.b_name=M[f.length-1].b_name),t("itemBrandValueChange",{options:y,index:n.index})},c=f=>{t("itemShowProductList",{index:n.index})},p=(f,M)=>M.some(y=>y.b_name.toLowerCase().indexOf(f.toLowerCase())>-1),O=f=>{const M=f?Number(f.split("-")[1]):null;return ne(ee.value,M)},g=f=>{if(f.length===0)return"";const M=f[f.length-1];return ne(ee.value,M)},I=G(()=>{const f=v.value;return`
                \u673A\u5668\u578B\u53F7\uFF1A${O(f.b_all_path)+" - "+g(f.brandValue)||"-"} ;\r

                \u673A\u8EAB\u7F16\u53F7\uFF1A${f.machine_id||"-"} ;\r

                \u539F\u6709\u6545\u969C\uFF1A${f.r_o_fault||"-"} ;\r

                \u786E\u8BA4\u6545\u969C\uFF1A${f.r_fault_desc||"-"} ;\r

                \u66F4\u6362\u914D\u4EF6\uFF1A${f.r_replace_part||"-"} ;\r

                \u4EF7\u683C\uFF1A${f.r_price||"-"} \u3002
            `}),E=j("onDMShow"),R=()=>{E(JSON.stringify([v.value]))},z=j("deliverSuccess"),D=()=>{d.$modal.confirm({title:"\u63D0\u793A",content:"\u786E\u5B9A\u8981\u53D6\u6D88\u53D1\u8D27\u4E48\uFF1F",icon:q(ge),okText:"\u786E\u5B9A",okType:"danger",zIndex:1005,onOk(){return new Promise((f,M)=>{d.$http.post("repair/cancel_deliver/"+v.value.r_id).then(y=>{y.success?(d.$message.success(y.message),z(),f(y)):M()}).catch(y=>{M(y)})})}})},w=f=>{v.value.r_relate_product.splice(f,1)},k=(f,M)=>{(!f||f===void 0)&&(v.value[M]=null)},P=S(!1),r=function(f){t("itemChecked",{index:_.value,checked:f.target.checked})},T=G(()=>{const f=d.$store.state.machine.engineers;return f&&f.length>0&&(v.value.u_id||f.forEach(M=>{if(M.default)return v.value.u_id=M.id})),f});return J(T.value)&&d.$store.dispatch("machine/get_engineers"),{brandData:ee,item:v,index:_,handleDelItem:i,fixProblem:Se,handleBrandChange:o,handleSearchPart:c,cascaderFilter:p,getBrand:O,getModel:g,handleDelPro:w,handleSelectorChange:k,copyData:I,handleDeliver:R,handleCandelDeliver:D,handleCheckboxChange:r,checked:P,engineers:T}}}),Z=e=>(Fe("data-v-2bafd02d"),e=e(),be(),e),ot={class:"form-table",id:"form-table",cellspacing:"0",cellpadding:"0"},st={class:"tdw100",colspan:"6"},ut={class:"tools__l"},it={class:"a-table__row"},dt=Z(()=>u("td",{class:"tdl tdl3_w"},[u("i",{class:"required"}," * "),m(" \u673A\u5668\u578B\u53F7")],-1)),rt={class:"tdc tdc3_w"},ct=Z(()=>u("td",{class:"tdl tdl3_w"}," \u673A\u5668\u7F16\u53F7 ",-1)),_t={class:"tdc tdc3_w"},pt=Z(()=>u("td",{class:"tdl tdl3_w"}," \u4EF7\u683C\uFF08\uFFE5\uFF09 ",-1)),mt={class:"tdc tdc3_w"},ft={class:"a-table__row"},ht=Z(()=>u("td",{class:"tdl tdl3_w"},"\u662F\u5426\u540C\u610F",-1)),vt={class:"tdc tdc3_w"},gt=m("\u540C\u610F\u7EF4\u4FEE"),Ft=m("\u62D2\u7EDD\u7EF4\u4FEE"),bt=Z(()=>u("td",{class:"tdl tdl3_w"}," \u7EF4\u4FEE\u72B6\u6001 ",-1)),Ct={class:"tdc tdc3_w"},wt=m("\u5DF2\u7EF4\u4FEE"),kt=m("\u7EF4\u4FEE\u4E2D"),Dt=m("\u539F\u673A\u8FD4"),Et=Z(()=>u("td",{class:"tdl tdl3_w"}," \u7EF4\u4FEE\u4EBA ",-1)),$t={class:"tdc tdc3_w"},yt={class:"a-table__row"},It=Z(()=>u("td",{class:"tdl tdl3_w"},"\u7269\u6D41\u540D\u79F0",-1)),At={class:"tdc tdc2_w",colspan:"2"},Bt=Z(()=>u("td",{class:"tdl tdl3_w"}," \u7269\u6D41\u53F7 ",-1)),St={class:"tdc tdc2_w",colspan:"2"},Lt={class:"a-table__row"},Ot=Z(()=>u("td",{class:"tdl tdl3_w"},"\u968F\u673A\u9644\u4EF6",-1)),Mt={class:"tdc tdcol5_w",colspan:"5"},Rt={class:"a-table__row"},Pt=Z(()=>u("td",{class:"tdl tdl3_w"},[u("i",{class:"required"}," * "),m("\u539F\u6709\u6545\u969C")],-1)),Vt={class:"tdc tdcol5_w",colspan:"5"},Ut={class:"a-table__row"},zt=Z(()=>u("td",{class:"tdl tdl3_w"},"\u786E\u8BA4\u6545\u969C",-1)),Tt={class:"tdc tdcol5_w",colspan:"5"},Nt={class:"a-table__row"},Yt=Z(()=>u("td",{class:"tdl tdl3_w"},"\u66F4\u6362\u914D\u4EF6",-1)),Zt={class:"tdc tdcol5_w",colspan:"5"},qt={class:"pro-selector"},jt={class:"pro-selected-li"},Jt=Z(()=>u("small",null," \xA0\xA0 \xA0\xA0 x",-1)),Kt={key:0,class:"isout",style:{color:"green"}},Ht=Z(()=>u("span",null,"\u5DF2\u51FA\u5E93",-1)),Gt={key:1,class:"isout",style:{color:"orange"}},Qt=Z(()=>u("span",null,"\u51FA\u5E93\u5931\u8D25",-1)),Wt={key:2,class:"isout",style:{color:"gray"}},Xt=Z(()=>u("span",null," \u5F85\u51FA\u5E93 ",-1)),xt={key:3,class:"split-btn"},ea=["onClick"],ta={class:"a-table__row"},aa=Z(()=>u("td",{class:"tdl tdl3_w"},"\u5907\u6CE8",-1)),la={class:"tdc tdcol5_w",colspan:"5"};function na(e,t,n,d,v,_){const i=s("a-checkbox"),o=s("a-col"),c=s("ZwIcons"),p=s("a-button"),O=s("a-tooltip"),g=s("CopyTwoTone"),I=s("DeleteTwoTone"),E=s("a-space"),R=s("a-row"),z=s("a-cascader"),D=s("a-input"),w=s("a-select-option"),k=s("a-select"),P=s("a-textarea"),r=s("UnorderedListOutlined"),T=s("a-input-search"),f=s("a-divider"),M=s("CheckCircleOutlined"),y=s("ExclamationCircleOutlined"),$=s("ClockCircleOutlined"),L=s("CloseCircleOutlined"),ue=re("clipboard");return C(),Y("table",ot,[u("tr",null,[u("td",st,[a(R,{class:"tools"},{default:l(()=>[a(o,{span:12},{default:l(()=>[u("div",ut,[a(i,{checked:e.checked,"onUpdate:checked":t[0]||(t[0]=h=>e.checked=h),onChange:e.handleCheckboxChange},{default:l(()=>[m(U(e.index)+" -- "+U(e.item.r_id),1)]),_:1},8,["checked","onChange"])])]),_:1}),a(o,{span:12},{default:l(()=>[a(E,{class:"tools__r",size:0},{default:l(()=>[e.item.r_is_deliver==1?(C(),V(O,{key:0,title:"\u53D6\u6D88\u53D1\u8D27"},{default:l(()=>[a(p,{type:"link",class:"candel-deliver",onClick:e.handleCandelDeliver},{default:l(()=>[a(c,{name:"fahuo",type:"svg"})]),_:1},8,["onClick"])]),_:1})):(C(),V(O,{key:1,title:"\u53BB\u53D1\u8D27"},{default:l(()=>[a(p,{type:"link",onClick:e.handleDeliver},{default:l(()=>[a(c,{name:"fahuo",type:"svg"})]),_:1},8,["onClick"])]),_:1})),a(O,{title:"\u590D\u5236\u6570\u636E"},{default:l(()=>[ce((C(),V(p,{type:"link"},{default:l(()=>[a(g)]),_:1})),[[ue,e.copyData]])]),_:1}),a(O,{title:"\u5220\u9664\u6B64\u9879"},{default:l(()=>[a(p,{type:"link",onClick:e.handleDelItem},{default:l(()=>[a(I,{twoToneColor:"#ff4d4f"})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})])]),u("tr",it,[dt,u("td",rt,[a(z,{value:e.item.brandValue,"onUpdate:value":t[1]||(t[1]=h=>e.item.brandValue=h),options:e.brandData,"field-names":{label:"b_name",value:"b_id"},"get-popup-container":e.fixProblem,"expand-trigger":"hover","change-on-select":"","show-search":{filter:e.cascaderFilter},placeholder:"\u9009\u62E9\u54C1\u724C\u578B\u53F7",onChange:e.handleBrandChange},null,8,["value","options","get-popup-container","show-search","onChange"])]),ct,u("td",_t,[a(D,{type:"text",value:e.item.machine_id,"onUpdate:value":t[2]||(t[2]=h=>e.item.machine_id=h),placeholder:"\u673A\u5668\u7F16\u53F7"},null,8,["value"])]),pt,u("td",mt,[a(D,{type:"text",value:e.item.r_price,"onUpdate:value":t[3]||(t[3]=h=>e.item.r_price=h),name:"r_price"},null,8,["value"])])]),u("tr",ft,[ht,u("td",vt,[a(k,{value:e.item.r_is_repair,"onUpdate:value":t[4]||(t[4]=h=>e.item.r_is_repair=h),name:"r_is_repair",placeholder:"\u8BF7\u9009\u62E9",allowClear:"","get-popup-container":e.fixProblem,onChange:t[5]||(t[5]=h=>e.handleSelectorChange(h,"r_is_repair"))},{default:l(()=>[a(w,{value:1},{default:l(()=>[gt]),_:1}),a(w,{value:2},{default:l(()=>[Ft]),_:1})]),_:1},8,["value","get-popup-container"])]),bt,u("td",Ct,[a(k,{value:e.item.r_repair_status,"onUpdate:value":t[6]||(t[6]=h=>e.item.r_repair_status=h),name:"r_repair_status",placeholder:"\u8BF7\u9009\u62E9",allowClear:"","get-popup-container":e.fixProblem,onChange:t[7]||(t[7]=h=>e.handleSelectorChange(h,"r_repair_status"))},{default:l(()=>[a(w,{value:1},{default:l(()=>[wt]),_:1}),a(w,{value:2},{default:l(()=>[kt]),_:1}),a(w,{value:3},{default:l(()=>[Dt]),_:1})]),_:1},8,["value","get-popup-container"])]),Et,u("td",$t,[a(k,{value:e.item.u_id,"onUpdate:value":t[8]||(t[8]=h=>e.item.u_id=h),name:"u_id",placeholder:"\u8BF7\u9009\u62E9",allowClear:"","get-popup-container":e.fixProblem},{default:l(()=>[(C(!0),Y(X,null,te(e.engineers,h=>(C(),V(w,{key:h.id,value:h.id},{default:l(()=>[m(U(h.realname||h.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","get-popup-container"])])]),u("tr",yt,[It,u("td",At,[a(D,{type:"text",value:e.item.logistics_name,"onUpdate:value":t[9]||(t[9]=h=>e.item.logistics_name=h),name:"logistics_name",placeholder:"\u7269\u6D41\u540D\u79F0"},null,8,["value"])]),Bt,u("td",St,[a(D,{type:"text",placeholder:"\u7269\u6D41\u5355\u53F7",value:e.item.logistics_num,"onUpdate:value":t[10]||(t[10]=h=>e.item.logistics_num=h),name:"logistics_num"},null,8,["value"])])]),u("tr",Lt,[Ot,u("td",Mt,[a(D,{type:"text",value:e.item.affix,"onUpdate:value":t[11]||(t[11]=h=>e.item.affix=h),name:"affix",placeholder:"\u968F\u673A\u9644\u5E26\u7684\u914D\u4EF6"},null,8,["value"])])]),u("tr",Rt,[Pt,u("td",Vt,[a(P,{value:e.item.r_o_fault,"onUpdate:value":t[12]||(t[12]=h=>e.item.r_o_fault=h),name:"r_o_fault",placeholder:"\u8F93\u5165\u673A\u5668\u539F\u59CB\u6545\u969C","auto-size":{minRows:2}},null,8,["value"])])]),u("tr",Ut,[zt,u("td",Tt,[a(P,{value:e.item.r_fault_desc,"onUpdate:value":t[13]||(t[13]=h=>e.item.r_fault_desc=h),name:"r_fault_desc",placeholder:"\u786E\u8BA4\u673A\u5668\u6545\u969C","auto-size":{minRows:2}},null,8,["value"])])]),u("tr",Nt,[Yt,u("td",Zt,[u("div",qt,[a(T,{value:e.item.r_replace_part,"onUpdate:value":t[14]||(t[14]=h=>e.item.r_replace_part=h),placeholder:"\u66F4\u6362\u914D\u4EF6\u8BF4\u660E, \u70B9\u51FB\u53F3\u4FA7\u6309\u94AE\u9009\u62E9\u5173\u8054\u914D\u4EF6",onSearch:e.handleSearchPart},{enterButton:l(()=>[a(p,{style:{"background-color":"#f2f2f2"}},{default:l(()=>[a(r)]),_:1})]),_:1},8,["value","onSearch"]),a(f),u("ol",jt,[(C(!0),Y(X,null,te(e.item.r_relate_product,(h,ie)=>(C(),Y("li",{key:h.p_id},[m(U(ie+1)+". "+U(e.getBrand(h.b_all_path))+" - "+U(h.b_name||e.getModel(h.b_all_path.split("-")))+" - "+U(h.f_name)+" ",1),Jt,m(" "+U(h.num)+" ",1),h.isOut==2?(C(),Y("span",Kt,[a(M),Ht])):h.isOut==3?(C(),Y("span",Gt,[a(y),Qt])):(C(),Y("span",Wt,[a($),Xt])),e.item.r_is_deliver===2?(C(),Y("span",xt,[u("span",{style:{color:"red",cursor:"pointer"},onClick:Ee=>e.handleDelPro(ie)},[a(L)],8,ea)])):Q("",!0)]))),128))])])])]),u("tr",ta,[aa,u("td",la,[a(P,{value:e.item.r_mark,"onUpdate:value":t[15]||(t[15]=h=>e.item.r_mark=h)},null,8,["value"])])])])}var oa=K(nt,[["render",na],["__scopeId","data-v-2bafd02d"]]);const sa=H({name:"ListModal",emits:["update:visible","ensure"],components:{},props:{visible:{type:Boolean,default:!1},keywords:{type:String,default:""},zIndexModel:{type:Number,default:1e3}},setup(e,{emit:t}){const n=S(null),d=[{title:"\u54C1\u724C",dataIndex:["b","b_all_path"],width:118,align:"center",customRender:({text:i})=>{const o=i?Number(i.split("-")[1]):null;return ne(ee.value,o)}},{title:"\u578B\u53F7",dataIndex:["b","b_name"],width:118,align:"center"},{title:"\u914D\u4EF6\u540D\u79F0",dataIndex:["f","f_name"],align:"center",width:152},{title:"\u603B\u6570",dataIndex:"p_total_num",align:"center",width:72},{title:"\u72B6\u6001",dataIndex:"p_state",width:72,align:"center",customRender:({text:i})=>q(s("a-tag"),{color:i===1?"blue":"orange"},{default:()=>i===1?"\u6B63\u5E38":"\u5904\u7406"})},{title:"\u64CD\u4F5C",dataIndex:"selection",width:108,align:"center"}],v=function(){t("update:visible",!1)};return{listdata:n,columns:d,handleCancel:v,handleOk:function(){const i=n.value.getSelectedRows();t("ensure",i),v()}}}}),ua=m("\u53D6\u6D88 "),ia=m("\u786E\u5B9A ");function da(e,t,n,d,v,_){const i=s("ListData"),o=s("CloseOutlined"),c=s("a-button"),p=s("CheckOutlined"),O=s("zwModal");return C(),V(O,oe({visible:e.visible,closable:!1},e.$attrs),{footer:l(()=>[a(c,{key:"back",onClick:e.handleCancel},{icon:l(()=>[a(o)]),default:l(()=>[ua]),_:1},8,["onClick"]),a(c,{key:"submit",type:"primary",onClick:e.handleOk},{icon:l(()=>[a(p)]),default:l(()=>[ia]),_:1},8,["onClick"])]),default:l(()=>[a(i,{ref:"listdata",keywords:e.keywords,columns:e.columns,rowKey:"p_id",apis:{query:"product",add:"product"},"dynamic-form":"ProductForm","z-index":e.zIndexModel+1,"can-select":!0},null,8,["keywords","columns","z-index"])]),_:1},16,["visible"])}var ra=K(sa,[["render",da]]),ca=H({name:"FormModal",components:{PlusOutlined:lt,MItem:oa,ListModal:ra},props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})}},setup(e,{emit:t}){const n=j("context"),d=S(!1),v=S(!1),_=S(!1),i="YYYY-MM-DD HH:mm:ss",o=_e({order:"",c_id:null,c_name:"",receipt_date:W(),mark:"",sum_price:0,delDatas:null,list:[x.exports.cloneDeep(de)]}),c=S([]);function p(F){return new Promise((A,b)=>{n.$http.get("repair/"+F).then(B=>{B.success?A(B.data):b(B.message)}).catch(B=>{b(B)})})}function O(F){return new Promise((A,b)=>{n.$http.get("repair_order/"+F).then(B=>{B.success?A(B.data):b(B.message)}).catch(B=>{b(B)})})}const g=_e({checkedIndexs:[],indeterminate:!1,checkedAll:!1}),I=({index:F,checked:A})=>{const b=g.checkedIndexs,B=b.includes(F);A?!B&&b.push(F):B&&b.splice(b.findIndex(N=>N===F,1))},E=function(F){g.indeterminate=!1;const A=F.target.checked;c.value.forEach(b=>{b.checked=A,I({index:b.index,checked:A})})},R=S(!0);function z(F,A){return le(this,null,function*(){if(A!=="add"&&F){d.value=!0;let b,B;A==="editSingle"?(b=yield p(F.r_id),B=[b]):(b=yield O(F.r_order),B=b.rs),d.value=!1,b.rs&&we(b.rs)?(o.order=b.order,o.c_id=b.c_id,o.c_name=b.c_name,o.receipt_date=W(b.receipt_date,i),o.mark=b.mark||""):(o.order=b.ro.order,o.c_id=b.ro.c_id,o.c_name=b.ro.c_name,o.receipt_date=W(b.ro.receipt_date,i),o.mark=b.ro.mark||""),o.list=B.map(N=>{const ae=N.brand.b_all_path;return N.b_all_path=ae,N.b_id=N.brand.b_id,N.b_name=N.brand.b_name,ae&&(N.brandValue=ae.split("-").map(ze=>Number(ze))),N})}else o.receipt_date=W(),o.list=[x.exports.cloneDeep(de)]})}je(()=>{e.visible&&z(e.formData.record,e.formData.mode)});const D=x.exports.throttle(()=>{o.list.push(x.exports.cloneDeep(de))},200),w=x.exports.throttle(F=>{if(o.list.length<=1)return n.$message.warn("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u6761\u6570\u636E\u4E86");n.$modal.confirm({title:"\u5220\u9664\u63D0\u793A",content:q("div",{},`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u7B2C ${F+1} \u6761\u6570\u636E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F`),icon:q(ge),okText:"\u786E\u5B9A",okType:"danger",zIndex:1005,onOk(){const A=o.list.splice(F,1);A[0].r_id&&(o.delDatas||(o.delDatas=[]),o.delDatas.push(A[0].r_id))}})},500);Ce(()=>g.checkedIndexs,F=>{g.indeterminate=!!F.length&&F.length<o.list.length,g.checkedAll=F.length===o.list.length},{deep:!0});const{indeterminate:k,checkedAll:P}=Je(g),r=()=>g.checkedIndexs.map(F=>o.list[F-1]),T=j("onDMShow"),f=function(){if(J(g.checkedIndexs))return n.$message.warn("\u8BF7\u9009\u62E9\u9700\u8981\u53D1\u8D27\u7684\u673A\u5668");T(JSON.stringify(r()))},M=S(""),y=function(F){if(F.preventDefault||F.cancelBubble,M.value="",J(g.checkedIndexs))return n.$message.warn("\u8BF7\u9009\u62E9\u9700\u8981\u590D\u5236\u7684\u673A\u5668\u4FE1\u606F");c.value.forEach((A,b)=>{A.checked&&(M.value+=A.copyData+`\r
\r
`)})};Ke(()=>{c.value=[]});const $=({options:F,index:A})=>{Object.assign(o.list[A],F)},L=S(null),ue=G(()=>L.value!==null&&L.value>=0?o.list[L.value].b_name:""),h=({index:F})=>{L.value=F,_.value=!0},ie=(F,A)=>{o.c_name=A.title},Ee=F=>{const A=[...o.list[L.value].r_relate_product],b=[...A];F.forEach(B=>{A.some(ae=>ae.p_id===B.p_id)||b.push({p_id:B.p_id,f_id:B.f_id,b_all_path:B.b.b_all_path,f_name:B.f.f_name,repair_price:B.repair_price,b_name:B.b.b_name,num:1,isOut:0})}),o.list[L.value].r_relate_product=J(b)?"":b};function Pe(){if(!o.c_id)return n.$message.warning("\u8BF7\u9009\u62E9\u5BA2\u6237"),!1;if(!o.list||o.list.length<=0)return n.$message.warning("\u7EF4\u4FEE\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A"),!1;let F=0;return o.list.forEach((A,b)=>{const B=A.r_relate_product;J(B)&&(A.r_relate_product=""),(!A.brandValue.length||!A.r_o_fault)&&(F++,n.$message.warning({content:q("span",{style:"color: #E6A23C; margin-left: 20px"},[q("b",{style:"color: #f00"},"* "),q("small",null,"\u4E3A\u5FC5\u586B\u9879, \u8BF7\u5B8C\u5584\u7B2C "),q("b",{style:"color: #f00"},b+1),q("small",null," \u6761\u6570\u636E")]),duration:2+.5*b,icon:q(ge)}))}),W.isDayjs(o.receipt_date)&&(o.receipt_date=o.receipt_date&&o.receipt_date.format(i)),F===0}function Ve(){return v.value=!0,new Promise((F,A)=>{if(!Pe())return v.value=!1,A();const b=e.formData.mode;let B="repair";(b==="edit"||b==="editSingle")&&(B="repair/"+o.order),n.$http({url:B,method:b==="add"?"POST":"PUT",data:o}).then(N=>{N.success?F(N):(n.$message.error(N.message),A(N.message))}).catch(N=>{A(N)})})}const Ue=()=>{Ve().then(F=>{n.$message.success(F.message),t("listreload")}).finally(()=>{v.value=!1})};return He(()=>{D.cancel(),w.cancel()}),{dateFormat:i,loadingList:d,confirmLoading:v,showListModal:_,mIndex:L,keywords:ue,foo:o,handleAdd:D,handleModalOk:Ue,modalClosed:()=>{o.order=null,o.c_id=null,o.c_name="",o.mark="",o.delDatas=null,o.receipt_date=null,o.sum_price=0,o.list=[x.exports.cloneDeep(de)],g.indeterminate=!1,c.value.forEach(F=>{F.checked=!1,I({index:F.index,checked:!1})})},handleDelItem:w,staffData:Le,fixProblem:Se,staffSelect:ie,handleBrandValueChange:$,handleShowProductList:h,handleProductSelected:Ee,onItemChecked:I,checkedAll:P,indeterminate:k,handleAllChecked:E,mItems:c,handleDeliver:f,copydata:M,handleCopyList:y,canEdit:R}}});const De=e=>(Fe("data-v-69dad64f"),e=e(),be(),e),_a={class:"form-table",cellspacing:"0",cellpadding:"0"},pa=De(()=>u("td",{class:"tdl tdl2_w"},[u("i",{class:"required"}," * "),m(" \u5BA2\u6237")],-1)),ma={class:"tdc tdc2_w"},fa=De(()=>u("td",{class:"tdl tdl2_w"}," \u6536\u8D27\u65F6\u95F4 ",-1)),ha={class:"tdc tdc2_w"},va=De(()=>u("td",{class:"tdl tdl_w"},"\u5907\u6CE8",-1)),ga={class:"tdc tdc_w",colspan:"3"},Fa=m(" \u7EF4\u4FEE\u673A\u6E05\u5355\uFF1A \u5171 "),ba=m(" \u53F0 "),Ca=m(" \u5168\u9009 "),wa={class:"tools-bar-btns"},ka=m("\u53D1\u8D27"),Da=m("\u590D\u5236\u4FE1\u606F"),Ea=m(" \u6DFB \u52A0 \u673A \u5668 ");function $a(e,t,n,d,v,_){const i=s("a-select-option"),o=s("a-select"),c=s("a-form-item"),p=s("a-date-picker");s("a-input");const O=s("a-textarea"),g=s("a-divider"),I=s("a-checkbox"),E=s("a-col"),R=s("a-button"),z=s("a-row"),D=s("MItem"),w=s("a-spin"),k=s("PlusOutlined"),P=s("a-form"),r=s("a-modal"),T=s("ListModal"),f=re("can-edit"),M=re("clipboard");return C(),Y(X,null,[a(r,oe({visible:e.visible,title:"\u7EF4\u4FEE\u673A"},e.$attrs,{"confirm-loading":e.confirmLoading,"z-index":100,"after-close":e.modalClosed,onOk:e.handleModalOk}),{default:l(()=>[a(P,{ref:"MachineForm",model:e.foo,class:"machine-form","label-col":{span:0},"wrapper-col":{span:24}},{default:l(()=>[u("table",_a,[u("tr",null,[pa,u("td",ma,[a(c,{name:"c_id"},{default:l(()=>[ce((C(),V(o,{value:e.foo.c_id,"onUpdate:value":t[0]||(t[0]=y=>e.foo.c_id=y),placeholder:"\u8BF7\u9009\u62E9","show-search":"",allowClear:"","option-filter-prop":"title","get-popup-container":e.fixProblem,onSelect:e.staffSelect},{default:l(()=>[(C(!0),Y(X,null,te(e.staffData,y=>(C(),V(i,{key:y.c_id,value:y.c_id,title:y.c_name},{default:l(()=>[m(U(y.c_name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","get-popup-container","onSelect"])),[[f,e.canEdit]])]),_:1})]),fa,u("td",ha,[a(p,{value:e.foo.receipt_date,"onUpdate:value":t[1]||(t[1]=y=>e.foo.receipt_date=y),"show-Time":"","allow-clear":"","value-format":e.dateFormat,format:e.dateFormat,getPopupContainer:e.fixProblem},null,8,["value","value-format","format","getPopupContainer"])])]),Q("",!0),u("tr",null,[va,u("td",ga,[a(c,{name:"mark"},{default:l(()=>[a(O,{value:e.foo.mark,"onUpdate:value":t[2]||(t[2]=y=>e.foo.mark=y),placeholder:"\u5907\u6CE8\u4FE1\u606F"},null,8,["value"])]),_:1})])])]),a(g,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:l(()=>[u("span",null,[Fa,u("strong",null,U(e.foo.list.length),1),ba])]),_:1}),e.foo.list.length>1?(C(),V(z,{key:0,class:"tools-bar"},{default:l(()=>[a(E,{class:"tools-bar-left",span:10},{default:l(()=>[a(I,{checked:e.checkedAll,"onUpdate:checked":t[3]||(t[3]=y=>e.checkedAll=y),indeterminate:e.indeterminate,onChange:e.handleAllChecked},{default:l(()=>[Ca]),_:1},8,["checked","indeterminate","onChange"])]),_:1}),a(E,{span:14},{default:l(()=>[u("div",wa,[a(R,{onClick:e.handleDeliver},{default:l(()=>[ka]),_:1},8,["onClick"]),ce((C(),V(R,{onClick:e.handleCopyList},{default:l(()=>[Da]),_:1},8,["onClick"])),[[M,e.copydata]])])]),_:1})]),_:1})):Q("",!0),a(w,{spinning:e.loadingList},{default:l(()=>[a(Ge,{name:"slide-fade",tag:"div"},{default:l(()=>[(C(!0),Y(X,null,te(e.foo.list,(y,$)=>(C(),V(D,{key:$,ref_for:!0,ref:L=>{L&&(e.mItems[$]=L)},itemValue:e.foo.list[$],"onUpdate:itemValue":L=>e.foo.list[$]=L,index:$,onItemDel:e.handleDelItem,onItemBrandValueChange:e.handleBrandValueChange,onItemShowProductList:e.handleShowProductList,onItemChecked:e.onItemChecked},null,8,["itemValue","onUpdate:itemValue","index","onItemDel","onItemBrandValueChange","onItemShowProductList","onItemChecked"]))),128))]),_:1})]),_:1},8,["spinning"]),e.formData.mode==="add"||e.formData.mode==="edit"?(C(),V(R,{key:1,block:"",onClick:e.handleAdd},{default:l(()=>[a(k),Ea]),_:1},8,["onClick"])):Q("",!0)]),_:1},8,["model"])]),_:1},16,["visible","confirm-loading","after-close","onOk"]),a(T,{visible:e.showListModal,"onUpdate:visible":t[4]||(t[4]=y=>e.showListModal=y),width:860,title:"\u4EA7\u54C1\u5217\u8868\u9009\u62E9","z-index-model":1101,"mask-closable":!1,keywords:e.keywords,onEnsure:e.handleProductSelected},null,8,["visible","keywords","onEnsure"])],64)}var ya=K(ca,[["render",$a],["__scopeId","data-v-69dad64f"]]);const Ia=H({name:"ColsInput",props:["fields","order","fieldsValue","placeholder","id"],setup(e,{emit:t}){const n=S("");Ce(()=>e.fieldsValue,o=>{n.value=o},{immediate:!0});const d=S(!0),v=S(null),_=()=>{d.value=!0,t("colsInputBlur",{id:e.id,value:n.value,fields:e.fields,order:e.order})},i=()=>{d.value=!1,We(()=>{v.value.focus()})};return Qe(()=>{}),{val:n,aInput:v,handleModify:_,isReadonly:d,handleEdit:i}}});function Aa(e,t,n,d,v,_){const i=s("EditOutlined"),o=s("a-input");return C(),V(o,{ref:"aInput",value:e.val,"onUpdate:value":t[1]||(t[1]=c=>e.val=c),disabled:e.isReadonly,placeholder:e.placeholder,size:"small",onBlur:e.handleModify,tabindex:e.id},{suffix:l(()=>[a(i,{onClick:t[0]||(t[0]=c=>e.handleEdit()),style:{color:"rgba(0, 0, 0, 0.65)",cursor:"pointer"}})]),_:1},8,["value","disabled","placeholder","onBlur","tabindex"])}var Be=K(Ia,[["render",Aa],["__scopeId","data-v-23e1ce4e"]]);const Ba=H({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:t}){const n=j("context");return{val:G({get(){return e.fieldsValue},set(_){t("update:fieldsValue",_)}}),handleChage:_=>{n.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:_}]}).then(i=>{n.$message.success(i.message),t("reload")})}}}}),Sa=m(" \u540C\u610F "),La=m(" \u62D2\u7EDD ");function Oa(e,t,n,d,v,_){const i=s("a-select-option"),o=s("a-select");return C(),V(o,{value:e.val,"onUpdate:value":t[0]||(t[0]=c=>e.val=c),placeholder:"\u8BF7\u9009\u62E9",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:l(()=>[a(i,{value:1},{default:l(()=>[Sa]),_:1}),a(i,{value:2},{default:l(()=>[La]),_:1})]),_:1},8,["value","onChange"])}var Ma=K(Ba,[["render",Oa]]);const Ra=H({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:t}){const n=j("context");return{val:G({get(){return e.fieldsValue},set(_){t("update:fields-value",_)}}),handleChage:_=>{n.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:_}]}).then(i=>{n.$message.success(i.message),t("reload")})}}}}),Pa=m(" \u5DF2\u7EF4\u4FEE "),Va=m(" \u7EF4\u4FEE\u4E2D "),Ua=m(" \u539F\u673A\u8FD4 ");function za(e,t,n,d,v,_){const i=s("a-select-option"),o=s("a-select");return C(),V(o,{value:e.val,"onUpdate:value":t[0]||(t[0]=c=>e.val=c),placeholder:"\u8BF7\u9009\u62E9",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:l(()=>[a(i,{value:1},{default:l(()=>[Pa]),_:1}),a(i,{value:2},{default:l(()=>[Va]),_:1}),a(i,{value:3},{default:l(()=>[Ua]),_:1})]),_:1},8,["value","onChange"])}var Ta=K(Ra,[["render",za]]);function Oe({text:e}){return e?e.substring(2,11):"--"}const ve=e=>[{title:"\u6536\u8D27\u65E5\u671F",dataIndex:"receipt_date",width:72,align:"center",customRender:Oe},{title:"\u59D3\u540D",dataIndex:"c_name",width:86,align:"center",ellipsis:!0,customCell:(t,n)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:d=>{d.stopPropagation(),e.clientCellClick(t,n,d)}})},{title:"\u578B\u53F7",dataIndex:"b_name",width:86,align:"center"},{title:"\u539F\u6545\u969C",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"\u786E\u8BA4\u6545\u969C",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(t,n)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:d=>{d.stopPropagation(),e.customCellClick(t,n,d)}})},{title:"\u66F4\u6362\u914D\u4EF6",dataIndex:"r_replace_part",ellipsis:!0,customCell:(t,n)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:d=>{d.stopPropagation(),e.customCellClick(t,n,d)}})}],Me=e=>[{title:"\u578B\u53F7",dataIndex:"b_name",width:86,align:"center"},{title:"\u539F\u6545\u969C",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"\u786E\u8BA4\u6545\u969C",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(t,n)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:d=>{d.stopPropagation(),e.customCellClick(t,n,d)}})},{title:"\u66F4\u6362\u914D\u4EF6",dataIndex:"r_replace_part",ellipsis:!0,customCell:(t,n)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:d=>{d.stopPropagation(),e.customCellClick(t,n,d)}})}],Re=e=>[{title:"\u4EF7\u683C(\uFFE5)",dataIndex:"r_price",width:86,customRender:({record:t,text:n})=>q(Be,{fields:"r_price",fieldsValue:n,id:t.r_id,placeholder:"\u7EF4\u4FEE\u4EF7\u683C",order:t.r_order,onColsInputBlur:e.colInputBlur})},{title:"\u662F\u5426\u7EF4\u4FEE",dataIndex:"r_is_repair",width:96,align:"center",customRender:({record:t,text:n})=>q(Ma,{fields:"r_is_repair",fieldsValue:n,order:t.r_order,"data-id":t.r_id,onReload:e.reload})},{title:"\u7EF4\u4FEE\u72B6\u6001",dataIndex:"r_repair_status",width:96,align:"center",customRender:({record:t,text:n})=>q(Ta,{fields:"r_repair_status",fieldsValue:n,order:t.r_order,"data-id":t.r_id,onReload:e.reload})},{title:"\u673A\u5668\u7F16\u53F7",dataIndex:"machine_id",width:132,customRender:({record:t,text:n})=>q(Be,{class:"ipt-font-bold",fields:"machine_id",fieldsValue:n,id:t.r_id,order:t.r_order,placeholder:"\u673A\u5668\u7F16\u53F7",onColsInputBlur:e.colInputBlur})}],Na=()=>[{title:"\u4EF7\u683C(\uFFE5)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"\u662F\u5426\u7EF4\u4FEE",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:pe},{title:"\u7EF4\u4FEE\u72B6\u6001",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:me},{title:"\u53D1\u8D27",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:ke},{title:"\u673A\u5668\u7F16\u53F7",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0}],Ya=e=>[...Me(e),...Re(e)],Za=e=>[...Me(e),...Na()];var qa={totalColumns(e){return[...ve(e),{title:"\u4EF7\u683C(\uFFE5)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"\u662F\u5426\u7EF4\u4FEE",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:pe},{title:"\u7EF4\u4FEE\u72B6\u6001",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:me},{title:"\u53D1\u8D27",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:ke},{title:"\u673A\u5668\u7F16\u53F7",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"\u64CD\u4F5C",dataIndex:"action",width:72,align:"center"}]},todoColumns(e){return[...ve(e),...Re(e),{title:"\u64CD\u4F5C",dataIndex:"action",width:72,align:"center"}]},doneColumns(e){return[{title:"\u53D1\u8D27\u65E5\u671F",dataIndex:"r_delivery_date",key:"r_delivery_date",width:72,align:"center",customRender:Oe},...ve(e),{title:"\u4EF7\u683C(\uFFE5)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"\u662F\u5426\u7EF4\u4FEE",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:pe},{title:"\u7EF4\u4FEE\u72B6\u6001",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:me},{title:"\u673A\u5668\u7F16\u53F7",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"\u64CD\u4F5C",dataIndex:"action",width:72,align:"center"}]}};const ja=H({name:"ClientRepairList",components:{},props:{visible:{type:Boolean,default:!1},formdata:{type:Object,default:()=>({})}},setup(e,{emit:t}){const n=j("context"),d=j("reload"),v=G(()=>{const k=n.$route.path;return k.includes("todo")?2:k.includes("done")?1:0}),_=S(0),i=()=>le(this,null,function*(){yield p.value.handleReload()}),o=(k,P,r)=>{t("showFormModal",{record:k,index:P,e:r})},c=v.value===2?Ya({customCellClick:o,colInputBlur(k){n.$http.put("repair/"+k.order,{order:k.order,list:[{r_id:k.id,[k.fields]:k.value}]}).then(P=>{n.$message.success(P.message),d()})},reload:d}):Za({customCellClick:o,reload:d}),p=S(null),O=k=>{k.c_id=e.formdata["ro.c_id"],k.deliver=v.value||null},g=S(0),I=k=>{g.value=k.data.count},E=S(""),R=function(k,P){const r=p.value.getSelectedRows();if(J(r))return P.stopPropagation||P.cancelBubble,n.$message.warn("\u8BF7\u5148\u9009\u62E9\u6570\u636E\uFF01\uFF01\uFF01");k==="copy"&&(E.value="",r.forEach(T=>{E.value+=`\u673A\u5668\u578B\u53F7\uFF1A${T.b_name}\r
\u673A\u8EAB\u7F16\u7801\uFF1A${T.machine_id}\r
\u539F\u6709\u6545\u969C\uFF1A${T.r_o_fault}\r
\u786E\u8BA4\u6545\u969C\uFF1A${T.r_fault_desc}\r
\u66F4\u6362\u914D\u4EF6\uFF1A${T.r_replace_part}\r
\u4EF7\u683C\uFF1A${T.r_price}\r
\r
`})),k==="diliver"&&t("showDeliverModal",JSON.stringify(r))},z=function(){t("update:visible",!1)},D=()=>{t("update:visible",!1)},w=k=>{_.value=k.reduce((P,r)=>P+=Number(r.r_price),0)};return Ce(()=>e.visible,k=>{k||(_.value=0)}),{isDeliverRef:v,columns:c,ListDataRefs:p,refresh:i,sumPriceRef:_,beforeListdataLoad:O,count:g,onListdataLoaded:I,handleToolsbarAction:R,copyData:E,handleCancel:z,handleOk:D,onListdataSelect:w}}}),se=e=>(Fe("data-v-695e280b"),e=e(),be(),e),Ja={class:"form-table",cellspacing:"0",cellpadding:"0"},Ka=se(()=>u("td",{class:"tdl tdl2_w"},"\u5BA2\u6237\u540D\u79F0",-1)),Ha={class:"tdc tdc2_w"},Ga=se(()=>u("td",{class:"tdl tdl2_w"}," \u8054\u7CFB\u65B9\u5F0F ",-1)),Qa={class:"tdc tdc2_w"},Wa=m(" \u7EF4\u4FEE\u673A\u5217\u8868 "),Xa=m(" \u5408\u8BA1\uFF1A"),xa=se(()=>u("small",null,"\uFFE5",-1)),el=m(),tl=m(" \u5143 "),al={class:"tools"},ll=m(" \u590D\u5236 "),nl=se(()=>u("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[u("path",{d:"M957.152011 169.189354c0-35.162848-28.760021-63.814398-64.031339-63.814398l-500.744655 0c-35.272341 0-64.031339 28.65155-64.031339 63.814398l0 105.705484c0 1.735527-0.759293 3.146667-2.279926 3.90596l-176.736237 92.89983c-49.867758 26.155706-82.48155 77.488839-82.48155 133.813658l0 320.0472 133.867894 0c0 0.10847 0 0.10847 0 0.162706l1.194198 0c11.883655 53.123918 59.147098 92.89983 115.852588 92.89983s103.969956-39.775912 115.853611-92.89983l1.465374 0c0.054235-0.054235 0.054235-0.054235 0.054235-0.162706l150.311401 0c0 0.10847 0 0.10847 0 0.162706l5.426593 0c11.93789 53.123918 59.147098 92.89983 115.906823 92.89983 56.760748 0 104.078427-39.830147 115.907846-93.062536l134.465504 0L957.153034 169.189354zM317.761646 863.058494c-34.944883 0-63.380516-28.434609-63.380516-63.380516s28.434609-63.380516 63.380516-63.380516c34.945907 0 63.381539 28.434609 63.381539 63.380516S352.708576 863.058494 317.761646 863.058494zM706.77866 863.058494c-34.944883 0-63.379493-28.434609-63.379493-63.380516s28.433586-63.380516 63.379493-63.380516c34.945907 0 63.380516 28.434609 63.380516 63.380516S741.724567 863.058494 706.77866 863.058494zM901.585461 769.995959l-80.093153 0c-13.240559-51.225685-59.365062-89.264023-114.714671-89.264023-55.402821 0-101.58156 38.039361-114.821095 89.264023L432.530552 769.995959c-13.239536-51.225685-59.365062-89.264023-114.767883-89.264023-55.402821 0-101.527324 38.039361-114.76686 89.264023l-80.58127 0L122.414539 505.514285c0-35.108612 20.239973-67.503417 52.798507-84.650959l175.705767-92.356454c20.402679-10.148128 32.992415-30.713512 32.992415-53.613058L383.911228 169.189354c0-4.450359 3.90596-8.248871 8.464789-8.248871l500.744655 0c4.557806 0 8.464789 3.798513 8.464789 8.248871L901.585461 769.995959z","p-id":"4974"}),u("path",{d:"M372.460432 382.499577c-15.356756 0-27.782763 12.426007-27.782763 27.78174l0 138.91484L205.761805 549.196157c-15.356756 0-27.782763 12.42703-27.782763 27.782763s12.42703 27.782763 27.782763 27.782763l166.697603 0c15.356756 0 27.782763-12.42703 27.782763-27.782763L400.242172 410.282341C400.243195 394.925584 387.816165 382.499577 372.460432 382.499577z","p-id":"4975"})],-1)),ol=m(" \u53D1\u8D27 "),sl=se(()=>u("span",null,null,-1)),ul=m("\u53D6 \u6D88 "),il=m("\u786E \u5B9A ");function dl(e,t,n,d,v,_){const i=s("a-divider"),o=s("a-col"),c=s("CopyOutlined"),p=s("a-button"),O=s("Icon"),g=s("a-row"),I=s("ListData"),E=s("CloseOutlined"),R=s("CheckOutlined"),z=s("ZwModal"),D=re("clipboard");return C(),V(z,oe({visible:e.visible},e.$attrs),{footer:l(()=>[a(p,{key:"back",onClick:e.handleCancel},{icon:l(()=>[a(E)]),default:l(()=>[ul]),_:1},8,["onClick"]),a(p,{key:"submit",type:"primary",onClick:e.handleOk},{icon:l(()=>[a(R)]),default:l(()=>[il]),_:1},8,["onClick"])]),default:l(()=>[u("table",Ja,[u("tr",null,[Ka,u("td",Ha,U(e.formdata.c_name),1),Ga,u("td",Qa,U(e.formdata.c_phone),1)])]),a(i,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:l(()=>[u("span",null,[Wa,u("b",null,"\u5171 "+U(e.count)+" \u53F0",1)])]),_:1}),a(g,{class:"tools-bar"},{default:l(()=>[a(o,{span:4},{default:l(()=>[Xa,xa,el,u("b",null,U(e.sumPriceRef),1),tl]),_:1}),a(o,{span:20},{default:l(()=>[u("div",al,[ce((C(),V(p,{onClick:t[0]||(t[0]=w=>e.handleToolsbarAction("copy",w))},{default:l(()=>[a(c),ll]),_:1})),[[D,e.copyData]]),e.isDeliverRef===2?(C(),V(p,{key:0,style:{"margin-left":"8px"},onClick:t[1]||(t[1]=w=>e.handleToolsbarAction("diliver",w))},{default:l(()=>[a(O,null,{component:l(()=>[nl]),_:1}),ol]),_:1})):Q("",!0)])]),_:1})]),_:1}),e.visible?(C(),V(I,{key:0,ref:"ListDataRefs",columns:e.columns,size:"small",bordered:"",rowKey:"r_id",apis:{query:"repair"},"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataLoaded:e.onListdataLoaded,onListdataSelect:e.onListdataSelect},{topTools:l(()=>[sl]),_:1},8,["columns","before-listdata-load","onListdataLoaded","onListdataSelect"])):Q("",!0)]),_:1},16,["visible"])}var rl=K(ja,[["render",dl],["__scopeId","data-v-695e280b"]]);const cl=H({name:"DeliverModal",props:{visible:{type:Boolean,default:!1},formdata:{type:Array,default:()=>[]},cid:{type:Number,default:null}},setup(e,{emit:t}){const n=j("context");S({tracking_num:"",delivery_date:""});const d=g=>{const I=g?Number(g.split("-")[1]):null;return ne(ee.value,I)},v=g=>{if(g.length===0)return"";const I=g[g.length-1];return ne(ee.value,I)},_=function(){t("update:visible",!1)},i=function(g){return g&&typeof g=="string"?JSON.parse(g):g},o=j("deliverSuccess");function c(){n.$modal.success({title:"\u53D1\u8D27\u6210\u529F\uFF01",content:"",zIndex:1009,onOk(){_(),o()}})}const p=S(!1);return{getBrand:d,getModel:v,handleCancel:_,submiting:p,handleOk:g=>{const I=e.formdata;if(!I&&I.length<=0)return n.$message.error("\u53D1\u8D27\u5217\u8868\u4E3A\u7A7A\uFF01");p.value=!0;const E={},R={};I.forEach(D=>{R.list||(R.list=[]),E.list||(E.list=[]);const w=D.r_relate_product,k=[],P=!J(w)&&Xe(w)?JSON.parse(w):we(w)?w:[];D.r_is_repair===1&&!J(P)&&(P.forEach(r=>{r.isOut!==2&&(r.io_num=r.num,r.o_type=1,r.o_state=1,r.r_id=D.r_id,r.isOut=2,k.push(r))}),E.list.push(...k)),E.mold=1,E.c_id=D["ro.c_id"],R.list.push(Object.assign(fe({},D),{r_is_deliver:1,r_relate_product:k.length>0?k:P})),R.order=D.r_order});const z={repair:R,io:E};g===1&&delete z.io,n.$http.post("repair/deliver",z).then(D=>{D.success?c():n.$message.error("\u53D1\u8D27\u5931\u8D25\uFF01")}).catch(D=>{console.log(D)}).finally(()=>{p.value=!1})},relateProductDeal:i}}}),_l={style:{"margin-bottom":"unset"}},pl=u("small",null," \xA0\xA0 \xA0\xA0 x",-1),ml={key:0,class:"isout"},fl=u("span",null,"\u51FA\u5E93\u4E2D...",-1),hl={key:1,class:"isout",style:{color:"green"}},vl=u("span",null,"\u5DF2\u51FA\u5E93",-1),gl={key:2,class:"isout",style:{color:"orange"}},Fl=u("span",null,"\u51FA\u5E93\u5931\u8D25",-1),bl={key:3,class:"isout",style:{color:"gray"}},Cl=u("span",null," \u5F85\u51FA\u5E93 ",-1),wl=m("\u53D6 \u6D88 "),kl=m("\u53D1 \u8D27 "),Dl=m("\u53D1\u8D27\u5E76\u51FA\u5E93 ");function El(e,t,n,d,v,_){const i=s("a-table-column"),o=s("LoadingOutlined"),c=s("CheckCircleOutlined"),p=s("ExclamationCircleOutlined"),O=s("ClockCircleOutlined"),g=s("a-table"),I=s("CloseOutlined"),E=s("a-button"),R=s("CheckOutlined"),z=s("ZwModal");return C(),V(z,oe({visible:e.visible},e.$attrs),{footer:l(()=>[a(E,{key:"back",onClick:e.handleCancel},{icon:l(()=>[a(I)]),default:l(()=>[wl]),_:1},8,["onClick"]),a(E,{key:"submit",type:"primary",onClick:t[0]||(t[0]=D=>e.handleOk(1)),loading:e.submiting},{icon:l(()=>[a(R)]),default:l(()=>[kl]),_:1},8,["loading"]),a(E,{key:"submit",type:"primary",onClick:t[1]||(t[1]=D=>e.handleOk(2)),loading:e.submiting},{icon:l(()=>[a(R)]),default:l(()=>[Dl]),_:1},8,["loading"])]),default:l(()=>[a(g,{dataSource:e.formdata,rowKey:"r_id",pagination:!1,bordered:"",size:"small"},{default:l(()=>[a(i,{width:45,"data-index":"index",title:"\u5E8F\u53F7",align:"center"},{default:l(({index:D})=>[m(U(D+1),1)]),_:1}),a(i,{"data-index":"b_all_path",width:146,title:"\u54C1\u724C",align:"center"},{default:l(({record:D,text:w})=>[m(U(e.getBrand(w))+" - "+U(D.b_name),1)]),_:1}),a(i,{"data-index":"r_fault_desc",width:176,title:"\u786E\u8BA4\u6545\u969C",align:"center"}),a(i,{"data-index":"r_replace_part",width:126,title:"\u66F4\u6362\u914D\u4EF6",align:"center"}),a(i,{"data-index":"r_relate_product",title:"\u5173\u8054\u4EA7\u54C1"},{default:l(({text:D})=>[u("ol",_l,[(C(!0),Y(X,null,te(e.relateProductDeal(D),w=>(C(),Y("li",{key:w.p_id},[m(U(e.getBrand(w.b_all_path))+" - "+U(w.b_name||e.getModel(w.b_all_path.split("-")))+" - "+U(w.f_name)+" ",1),pl,m(U(w.num)+" ",1),w.isOut==1?(C(),Y("span",ml,[a(o),fl])):w.isOut==2?(C(),Y("small",hl,[a(c),vl])):w.isOut==3?(C(),Y("small",gl,[a(p),Fl])):(C(),Y("small",bl,[a(O),Cl]))]))),128))])]),_:1})]),_:1},8,["dataSource"])]),_:1},16,["visible"])}var $l=K(cl,[["render",El]]);const yl=H({name:"LogisticsAdd",props:{visible:{type:Boolean,default:!1},selectedRows:{type:Array,default(){return[]}}},setup(e,{emit:t}){const n=j("context"),d=S(null),v=S(null),_=S({logistics_num:"",logistics_name:""}),i=function(){t("update:visible",!1)};return{modal:d,logisticsForm:v,formdata:_,handleCancel:i,handleOk:()=>le(this,null,function*(){try{const c=yield v.value.validate();console.log(c),console.log(e.selectedRows),n.$http.post("repair/updateLogistics",Ie(fe({},c),{ids:e.selectedRows.map(p=>p.r_id)})).then(p=>{p.success?(n.$message.success(p.message),setTimeout(i,500)):n.$message.error(p.message)}).catch(p=>{console.log(p),n.$message.error(p)}).finally(()=>{d.value.submiting=!1})}catch(c){d.value.submiting=!1}}),columns:[{title:"\u59D3\u540D",dataIndex:"c_name",width:106,align:"center"},{title:"\u578B\u53F7",dataIndex:"b_name",width:96,align:"center"},{title:"\u662F\u5426\u7EF4\u4FEE",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:pe},{title:"\u7EF4\u4FEE\u72B6\u6001",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:me},{title:"\u53D1\u8D27",dataIndex:"r_is_deliver",width:62,align:"center",customRender:ke},{title:"\u7269\u6D41\u540D\u79F0",dataIndex:"logistics_name",align:"center"},{title:"\u7269\u6D41\u5355\u53F7",dataIndex:"logistics_num",align:"center"}]}}});function Il(e,t,n,d,v,_){const i=s("a-table"),o=s("a-divider"),c=s("a-input"),p=s("a-form-item"),O=s("a-form"),g=s("ZwModal");return C(),V(g,oe({ref:"modal",visible:e.visible},e.$attrs,{onSubmit:e.handleOk}),{default:l(()=>[a(i,{dataSource:e.selectedRows,columns:e.columns,pagination:!1,size:"small"},null,8,["dataSource","columns"]),a(o),a(O,{ref:"logisticsForm",model:e.formdata,name:"logisticsForm","label-col":{span:5},"wrapper-col":{span:17}},{default:l(()=>[a(p,{label:"\u7269\u6D41\u540D\u79F0",name:"logistics_name",rules:[{required:!0,message:"Please input your \u7269\u6D41\u540D\u79F0"}]},{default:l(()=>[a(c,{value:e.formdata.logistics_name,"onUpdate:value":t[0]||(t[0]=I=>e.formdata.logistics_name=I)},null,8,["value"])]),_:1}),a(p,{label:"\u7269\u6D41\u53F7",name:"logistics_num",rules:[{required:!0,message:"Please input your \u7269\u6D41\u53F7"}]},{default:l(()=>[a(c,{value:e.formdata.logistics_num,"onUpdate:value":t[1]||(t[1]=I=>e.formdata.logistics_num=I)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},16,["visible","onSubmit"])}var Al=K(yl,[["render",Il]]);const Bl=H({name:"MaintainList",components:{FormModal:ya,ClientRepairList:rl,DeliverModal:$l,LogisticsAdd:Al},props:{topTools:{type:Object,default(){return{}}},pageMode:{type:String,default:"total"}},setup(e){const t=j("context"),n=S(null),d=()=>{n.value.handleReload()},v=()=>{n.value.handleSearch()},_=_e({r_is_repair:null,r_repair_status:null,c_id:null,timeRange:null}),i=S(!1),o=S(!1),c=S(null),p=S(!1),O=S([]),g=$=>{p.value=!0,O.value=JSON.parse($)};he("onDMShow",g);const I=()=>le(this,null,function*(){o.value&&(yield c.value.refresh()),d(),i.value=!1});he("reload",I);const E=_e({mode:"add",record:{}}),R=({record:$})=>{E.mode="editSingle",E.record=$,i.value=!0},z=qa[`${e.pageMode}Columns`]({clientCellClick:$=>{E.record=$,o.value=!0},customCellClick:$=>{E.mode="editSingle",E.record=$,i.value=!0},colInputBlur($){t.$http.put("repair/"+$.order,{order:$.order,list:[{r_id:$.id,[$.fields]:$.value}]}).then(L=>{t.$message.success(L.message),d()})},reload(){d()}}),D=$=>{e.pageMode==="todo"?$.deliver=2:e.pageMode=="done"&&($.deliver=1),Object.keys(_).forEach(L=>{L==="timeRange"&&(!J(_[L])&&we(_[L])?(_[L][0]&&(_.start=W(_[L][0]).format("YYYY-MM-DD")+" 00:00:00"),_[L][1]&&(_.end=W(_[L][1]).format("YYYY-MM-DD")+" 23:59:59")):(delete _.start,delete _.end))}),Object.assign($,_)},w=($,L,ue)=>(E.mode=$,E.record=L,i.value=!0,!1);he("deliverSuccess",function(){i.value=!1,o.value=!1,d()});const P=($,L)=>{n.value.handleAction.edit($,L)},r=$=>{n.value.handleAction.del($)},T=S([]),f=$=>{T.value=$},M=S(!1);return{listdata:n,modalVisible:i,columns:z,ClientRepairList:c,crlVisible:o,formData:E,dmVisible:p,dmFormData:O,onDeliverModalVisible:g,beforeListdataLoad:D,beforeFormOpen:w,reload:I,clientListEditEvent:R,appendSearch:_,handleReload:d,handleSearch:v,handleRowEdit:P,handleRowDel:r,selectedRows:T,onListdataSelect:f,showAddLogisticsInfoDialog:()=>{M.value=!0},logisticsDialogVisible:M,staffData:Le}}}),Sl=m("\u540C\u610F"),Ll=m("\u62D2\u7EDD"),Ol=m("\u5DF2\u7EF4\u4FEE"),Ml=m("\u7EF4\u4FEE\u4E2D"),Rl=m("\u539F\u673A\u8FD4"),Pl=m(" \u7269\u6D41\u4FE1\u606F ");function Vl(e,t,n,d,v,_){const i=s("a-select-option"),o=s("a-select"),c=s("a-range-picker"),p=s("a-button"),O=s("FormModal"),g=s("EditFilled"),I=s("a-tooltip"),E=s("DeleteTwoTone"),R=s("a-space"),z=s("ListData"),D=s("ClientRepairList"),w=s("DeliverModal"),k=s("LogisticsAdd"),P=s("ZwScrollbar");return C(),V(P,{"wrap-class":"pd-17"},{default:l(()=>[a(z,{ref:"listdata",rowKey:"r_id",columns:e.columns,apis:"repair","top-tools":e.topTools,"before-form-open":e.beforeFormOpen,"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataSelect:e.onListdataSelect},xe({modal:l(()=>[a(O,{visible:e.modalVisible,"onUpdate:visible":t[4]||(t[4]=r=>e.modalVisible=r),"form-data":e.formData,width:1020,"mask-closable":!1,"z-index":1002,onListreload:e.reload},null,8,["visible","form-data","onListreload"])]),action:l(r=>[et(e.$slots,"action",tt(at(r)),()=>[a(R,{size:2},{default:l(()=>[a(I,{title:"\u7F16\u8F91","mouseLeave-delay":0},{default:l(()=>[a(p,{type:"link",size:"small",onClick:Ae(T=>e.handleRowEdit(r.record,r.index),["stop"])},{icon:l(()=>[a(g)]),_:2},1032,["onClick"])]),_:2},1024),a(I,{title:"\u5220\u9664","mouseLeave-delay":0},{default:l(()=>[a(p,{type:"link",size:"small",onClick:Ae(T=>e.handleRowDel(r.record),["stop"])},{icon:l(()=>[a(E,{twoToneColor:"#ff4d4f"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)],!0)]),_:2},[e.pageMode!=="done"?{name:"append-search",fn:l(()=>[a(o,{value:e.appendSearch.r_is_repair,"onUpdate:value":t[0]||(t[0]=r=>e.appendSearch.r_is_repair=r),name:"r_is_repair",placeholder:"\u662F\u5426\u7EF4\u4FEE",allowClear:"",onChange:e.handleSearch},{default:l(()=>[a(i,{value:1},{default:l(()=>[Sl]),_:1}),a(i,{value:2},{default:l(()=>[Ll]),_:1})]),_:1},8,["value","onChange"]),a(o,{value:e.appendSearch.r_repair_status,"onUpdate:value":t[1]||(t[1]=r=>e.appendSearch.r_repair_status=r),name:"r_repair_status",placeholder:"\u7EF4\u4FEE\u72B6\u6001",allowClear:"",onChange:e.handleSearch},{default:l(()=>[a(i,{value:1},{default:l(()=>[Ol]),_:1}),a(i,{value:2},{default:l(()=>[Ml]),_:1}),a(i,{value:3},{default:l(()=>[Rl]),_:1})]),_:1},8,["value","onChange"]),e.pageMode==="total"?(C(),V(o,{key:0,value:e.appendSearch.c_id,"onUpdate:value":t[2]||(t[2]=r=>e.appendSearch.c_id=r),name:"c_id",placeholder:"\u5BA2\u6237\u59D3\u540D","show-search":"",allowClear:"","option-filter-prop":"title",onChange:e.handleSearch},{default:l(()=>[(C(!0),Y(X,null,te(e.staffData,r=>(C(),V(i,{key:r.c_id,value:r.c_id,title:r.c_name},{default:l(()=>[m(U(r.c_name),1)]),_:2},1032,["value","title"]))),128))]),_:1},8,["value","onChange"])):Q("",!0),e.pageMode==="total"?(C(),V(c,{key:1,name:"timeRange",value:e.appendSearch.timeRange,"onUpdate:value":t[3]||(t[3]=r=>e.appendSearch.timeRange=r)},null,8,["value"])):Q("",!0),a(p,{disabled:e.selectedRows.length<=0,onClick:e.showAddLogisticsInfoDialog},{default:l(()=>[Pl]),_:1},8,["disabled","onClick"])])}:void 0]),1032,["columns","top-tools","before-form-open","before-listdata-load","onListdataSelect"]),a(D,{ref:"ClientRepairList",visible:e.crlVisible,"onUpdate:visible":t[5]||(t[5]=r=>e.crlVisible=r),title:"\u5BA2\u6237\u7EF4\u4FEE\u673A\u5217\u8868",formdata:e.formData.record||{},width:1280,"mask-closable":!1,onShowDeliverModal:e.onDeliverModalVisible,onShowFormModal:e.clientListEditEvent,"z-index":99},null,8,["visible","formdata","onShowDeliverModal","onShowFormModal"]),a(w,{visible:e.dmVisible,"onUpdate:visible":t[6]||(t[6]=r=>e.dmVisible=r),title:"\u53D1\u8D27\u673A\u5217\u8868",formdata:e.dmFormData,"onUpdate:formdata":t[7]||(t[7]=r=>e.dmFormData=r),width:930,"mask-closable":!1,"z-index":1003},null,8,["visible","formdata"]),a(k,{visible:e.logisticsDialogVisible,"onUpdate:visible":t[8]||(t[8]=r=>e.logisticsDialogVisible=r),title:"\u6279\u91CF\u6DFB\u52A0\u7269\u6D41\u4FE1\u606F",width:930,"selected-rows":e.selectedRows},null,8,["visible","selected-rows"])]),_:3})}var Kl=K(Bl,[["render",Vl],["__scopeId","data-v-17eb18a1"]]);export{Kl as M};
