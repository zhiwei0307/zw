var e=(e,a,l)=>new Promise(((s,t)=>{var r=e=>{try{o(l.next(e))}catch(a){t(a)}},n=e=>{try{o(l.throw(e))}catch(a){t(a)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,n);o((l=l.apply(e,a)).next())}));import"./vue.3c1b29c4.js";import{l as a}from"./lodash.5f175b98.js";import{_ as l,i as s}from"./index.be91b483.js";import{d as t,k as r,v as n,f as o,_ as i,$ as u,a2 as d,m as p,a1 as c,F as m,a9 as f,aa as v,J as g,a3 as w,ab as h,y as b,a0 as y,ae as _,l as R,o as k,B as C,ad as P,a8 as j,a7 as x}from"./@vue.61fb48b5.js";import"./dayjs.39b8ebe2.js";import"./ant-design-vue.fade4faf.js";import"./@babel.eda524f0.js";import"./regenerator-runtime.7769f52d.js";import"./@ant-design.2f8223f0.js";import"./@ctrl.fa7cbd46.js";import"./lodash-es.a53432ff.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./vuex.fb8d35f6.js";import"./axios.82d3905a.js";import"./vue-router.9a97da5e.js";import"./nprogress.6eaf9b6f.js";import"./js-cookie.31874410.js";import"./clipboard.5999f2a2.js";const F=t({name:"PersonalPwd",props:{pwd:{type:String,default:()=>""}},setup(a,{emit:l}){const s=r("context"),t=n(null),i=n(!1),u=n(null),d=o({password:"",newPassword:"",newPassword2:""}),p=()=>{u.value.resetFields()};return{modalRef:t,visibleRef:i,pwdFormRef:u,fdRef:d,rules:{password:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]{6,16}$/,message:"密码由大写字母、小写字母 或 _ 组成",trigger:"blur"}],newPassword2:[{required:!0,validator:(a,l)=>e(this,null,(function*(){return""===l?Promise.reject("请再次输入密码！"):l!==d.newPassword?Promise.reject("两次密码不一致"):Promise.resolve()})),trigger:"blur"}]},submit:()=>{u.value.validate().then((()=>s.$http.put("user/update/password",{password:d.password,newPassword:d.newPassword}))).then((e=>{s.$message[e.success?"success":"error"](e.message),e.success&&p()})).catch((e=>{console.log("error",e)})).finally((()=>{t.value.submiting=!1}))},onClose:()=>{p()}}}}),U=(e=>(f("data-v-973e37b2"),e=e(),v(),e))((()=>w("span",{class:"show pwd"}," ****** ",-1))),$=g("修改密码");var S=l(F,[["render",function(e,a,l,s,t,r){const n=i("a-button"),o=i("a-input-password"),f=i("a-form-item"),v=i("a-divider"),g=i("a-form"),w=i("zw-modal");return u(),d(m,null,[U,p(n,{onClick:a[0]||(a[0]=a=>e.visibleRef=!0)},{default:c((()=>[$])),_:1}),p(w,{ref:"modalRef",visible:e.visibleRef,"onUpdate:visible":a[4]||(a[4]=a=>e.visibleRef=a),title:"密码修改",width:600,"mask-closable":!1,onSubmit:e.submit,onClose:e.onClose,onCancel:e.onClose},{default:c((()=>[p(g,{ref:"pwdFormRef",class:"pwd-form",model:e.fdRef,rules:e.rules,layout:"vertical"},{default:c((()=>[p(f,{label:"当前密码",name:"password"},{default:c((()=>[p(o,{value:e.fdRef.password,"onUpdate:value":a[1]||(a[1]=a=>e.fdRef.password=a),placeholder:"请输入当前密码"},null,8,["value"])])),_:1}),p(v,{type:"horizontal",style:{"margin-top":"0"}}),p(f,{label:"新密码",name:"newPassword"},{default:c((()=>[p(o,{value:e.fdRef.newPassword,"onUpdate:value":a[2]||(a[2]=a=>e.fdRef.newPassword=a),placeholder:"请输入新密码"},null,8,["value"])])),_:1}),p(f,{label:"确认密码",name:"newPassword2"},{default:c((()=>[p(o,{value:e.fdRef.newPassword2,"onUpdate:value":a[3]||(a[3]=a=>e.fdRef.newPassword2=a),placeholder:"确认密码"},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onSubmit","onClose","onCancel"])],64)}],["__scopeId","data-v-973e37b2"]]);const E=t({name:"PhoneSet",props:{phone:{type:String,default:()=>""}},setup(e,{emit:a}){const l=r("context"),s=n(null),t=n(!1),i=n(null),u=o({password:"",phone:e.phone||""}),d=()=>{i.value.resetFields()};return{modalRef:s,visibleRef:t,formRef:i,fdRef:u,rules:{password:[{required:!0,message:"登录密码不能为空",trigger:"blur"}],phone:[{required:!0,message:"新手号码不能为空",trigger:"blur"},{pattern:/0?(13|14|15|16|17|18|19)[0-9]{9}/,message:"手机号码格式不正确",trigger:"blur"}]},submit:()=>{i.value.validate().then((()=>l.$http.put("user/update/phone",u))).then((e=>{if(!e.success)return l.$message.error(e.message),void(s.value.submiting=!1);l.$message.success(e.message),a("update:phone",u.phone),t.value=!1,d()})).catch((e=>{console.log("error",e)})).finally((()=>{}))},onClose:()=>{d()}}}}),D={class:"show phone"},I=g("更换号码");var z=l(E,[["render",function(e,a,l,s,t,r){const n=i("a-button"),o=i("a-input"),f=i("a-form-item"),v=i("a-input-password"),g=i("a-form"),b=i("zw-modal");return u(),d(m,null,[w("span",D,h(e.phone),1),p(n,{onClick:a[0]||(a[0]=a=>e.visibleRef=!0)},{default:c((()=>[I])),_:1}),p(b,{ref:"modalRef",visible:e.visibleRef,"onUpdate:visible":a[3]||(a[3]=a=>e.visibleRef=a),title:"手机号码更改",width:600,"mask-closable":!1,onSubmit:e.submit,onClose:e.onClose,onCancel:e.onClose},{default:c((()=>[p(g,{ref:"formRef",class:"pwd-form",model:e.fdRef,rules:e.rules,layout:"vertical"},{default:c((()=>[p(f,{label:"新手机号",name:"phone",required:""},{default:c((()=>[p(o,{value:e.fdRef.phone,"onUpdate:value":a[1]||(a[1]=a=>e.fdRef.phone=a),placeholder:"请输入新手机号码"},null,8,["value"])])),_:1}),p(f,{label:"密码",name:"password",required:""},{default:c((()=>[p(v,{value:e.fdRef.password,"onUpdate:value":a[2]||(a[2]=a=>e.fdRef.password=a),placeholder:"请输入登录密码"},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onSubmit","onClose","onCancel"])],64)}],["__scopeId","data-v-7b9707bf"]]);const A=t({name:"PhoneSet",props:{email:{type:String,default:()=>""}},setup(a,{emit:l}){const s=r("context"),t=n(!1),i=n(null),u=n(!1),d=n(null),p=o({password:"",email:"",newEmail:"",verifyCode:""});b((()=>{p.email=a.email}));const c=n(0),m=()=>{d.value.resetFields()};return{loading:t,current:c,next:()=>e(this,null,(function*(){let e;t.value=!0,0===c.value&&(e=yield new Promise(((e,a)=>{s.$http.post("user/verify_email",{email:p.email,password:p.password}).then((a=>{e(a),s.$message[a.success?"success":"error"](a.message)})).catch((e=>{a(e)}))}))),1===c.value&&(e=yield new Promise(((e,a)=>{s.$http.post("user/get_verify_email_code",{email:p.newEmail}).then((a=>{e(a),s.$message[a.success?"success":"error"](a.message)})).catch((e=>{a(e)}))}))),2===c.value&&(e=yield new Promise(((e,a)=>{s.$http.post("user/update/email",{email:p.newEmail,code:p.verifyCode}).then((a=>{e(a),s.$message[a.success?"success":"error"](a.message)})).catch((e=>{a(e)}))}))),e.success&&(c.value>=2&&l("update:email",p.newEmail),c.value++),t.value=!1})),prev:()=>{c.value--},modalRef:i,visibleRef:u,formRef:d,fdRef:p,rules:{password:[{required:!0,message:"登录密码不能为空",trigger:"blur"}],email:[{required:!0,message:"当前邮箱不能为空",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"邮箱格式不正确",trigger:"blur"}]},done:()=>{u.value=!1,c.value=0,m()},onClose:()=>{m()}}}}),q={class:"show pwd"},Z=g("更换邮箱"),T={class:"steps-content"},O={class:"steps-action"},B=g(" 上一步 "),G=g(" 下一步 "),L=g(" 完成 ");var J=l(A,[["render",function(e,a,l,s,t,r){const n=i("a-button"),o=i("a-step"),f=i("a-steps"),v=i("a-input"),g=i("a-form-item"),b=i("a-input-password"),R=i("a-result"),k=i("a-form"),C=i("zw-modal");return u(),d(m,null,[w("span",q,h(e.email),1),p(n,{onClick:a[0]||(a[0]=a=>e.visibleRef=!0)},{default:c((()=>[Z])),_:1}),p(C,{ref:"modalRef",visible:e.visibleRef,"onUpdate:visible":a[5]||(a[5]=a=>e.visibleRef=a),title:"手机号码更改",width:600,"mask-closable":!1,onClose:e.onClose,onCancel:e.onClose},{footer:c((()=>[w("div",O,[e.current>0&&e.current<3?(u(),y(n,{key:0,onClick:e.prev,loading:e.loading},{default:c((()=>[B])),_:1},8,["onClick","loading"])):_("",!0),e.current<3?(u(),y(n,{key:1,type:"primary",onClick:e.next,loading:e.loading},{default:c((()=>[G])),_:1},8,["onClick","loading"])):_("",!0),3==e.current?(u(),y(n,{key:2,type:"primary",onClick:e.done},{default:c((()=>[L])),_:1},8,["onClick"])):_("",!0)])])),default:c((()=>[p(f,{current:e.current,size:"small"},{default:c((()=>[(u(),y(o,{key:0,title:"验证当前邮箱"})),(u(),y(o,{key:1,title:"输入新邮箱"})),(u(),y(o,{key:2,title:"新邮箱验证"})),(u(),y(o,{key:3,title:"完成"}))])),_:1},8,["current"]),w("div",T,[p(k,{ref:"formRef",class:"form-box",model:e.fdRef,"label-col":{span:4}},{default:c((()=>[0===e.current?(u(),d(m,{key:0},[p(g,{label:"当前邮箱",name:"email",rules:e.rules.email},{default:c((()=>[p(v,{value:e.fdRef.email,"onUpdate:value":a[1]||(a[1]=a=>e.fdRef.email=a),placeholder:"请输入当前邮箱"},null,8,["value"])])),_:1},8,["rules"]),p(g,{label:"登录密码",name:"password",rules:e.rules.password},{default:c((()=>[p(b,{value:e.fdRef.password,"onUpdate:value":a[2]||(a[2]=a=>e.fdRef.password=a),placeholder:"请输入登录密码"},null,8,["value"])])),_:1},8,["rules"])],64)):_("",!0),1===e.current?(u(),y(g,{key:1,label:"新邮箱",name:"newEmail",rules:e.rules.newEmail},{default:c((()=>[p(v,{value:e.fdRef.newEmail,"onUpdate:value":a[3]||(a[3]=a=>e.fdRef.newEmail=a),placeholder:"请输入新邮箱"},null,8,["value"])])),_:1},8,["rules"])):_("",!0),2===e.current?(u(),y(g,{key:2,label:"验证码",name:"newEmail",rules:e.rules.newEmail},{default:c((()=>[p(v,{value:e.fdRef.verifyCode,"onUpdate:value":a[4]||(a[4]=a=>e.fdRef.verifyCode=a),placeholder:"请输入验证码"},null,8,["value"])])),_:1},8,["rules"])):_("",!0),3===e.current?(u(),y(R,{key:3,status:"success",title:"邮箱更新成功！"})):_("",!0)])),_:1},8,["model"])])])),_:1},8,["visible","onClose","onCancel"])],64)}],["__scopeId","data-v-6132a4e6"]]);const M=t({name:"AvatarUpload",props:{avatar:{type:String,default:()=>""},accept:{type:String,default:()=>"image/*"}},setup(a,{emit:l}){const t=r("context"),o=n(null),i=n(null),u=R({get:()=>a.avatar,set(e){l("update:avatar",e)}}),d=n(0),p=n(!1);const c=e=>{if(!function(e){return/^image\//.test(e.type)?!!(e.size/1024/1024<2)||(t.$message.warning("Image must smaller than 2MB!"),!1):(t.$message.warning("You can only upload Picture file!"),!1)}(e))return;p.value=!0;const a=new FormData;return a.append("file",e),new Promise(((e,l)=>{t.$http.post("/user/update/avatar",a,{headers:{"Content-Type":"multipart/form-data; boundary="+(new Date).getTime()},onUploadProgress:e=>{d.value=e.loaded/e.total*100|0}}).then((a=>{e(a)})).catch((e=>{l(e)})).finally((()=>{p.value=!1,d.value=0}))}))},m=a=>e(this,null,(function*(){const e=a.target.files;s(e)||(i.value=e[0],c(e[0]).then((e=>{o.value.value="",t.$message[e.success?"success":"error"](e.message),e.success&&(u.value=e.data.avatar)})))}));return k((()=>{o.value.addEventListener("change",m)})),C((()=>{o.value.removeEventListener("change",m)})),{inputFileEl:o,handleSelectFile:()=>{o.value.click()},delAvatar:()=>{t.$modal.confirm({title:"警告",content:"确定删除么？",okText:"确定",okType:"danger",onOk:()=>new Promise((e=>{t.$http.delete("/user/delete/avatar").then((a=>{t.$message[a.success?"success":"error"](a.message),a.success&&(u.value=""),e(a)}))}))})},previewImg:u,uploading:p,progress:d}}}),Y={class:"avatar"},H={ref:"inputFileEl",type:"file",accept:"image/*",style:{display:"none"}},K={key:0,class:"no-avatar"},N=(e=>(f("data-v-aea5d2c8"),e=e(),v(),e))((()=>w("div",{class:"upload-text"},"上传头像",-1))),Q={class:"avatar-actions"},V={title:"大图预览"},W={key:1,class:"progress"};var X,ee,ae=l(M,[["render",function(e,a,l,s,t,r){const n=i("cloud-upload-outlined"),o=i("eye-outlined"),c=i("a-image"),f=i("delete-outlined"),v=i("a-progress");return u(),d("div",Y,[w("span",{class:"avatar-upload",onClick:a[0]||(a[0]=(...a)=>e.handleSelectFile&&e.handleSelectFile(...a))},[w("input",H,null,512),e.previewImg?_("",!0):(u(),d("div",K,[p(n),N]))]),e.previewImg?(u(),d(m,{key:0},[w("div",{class:"preview",style:P("background-image: url("+e.previewImg+")")},null,4),w("span",Q,[w("i",V,[p(o),p(c,{src:e.previewImg},null,8,["src"])]),w("i",{title:"删除",onClick:a[1]||(a[1]=(...a)=>e.delAvatar&&e.delAvatar(...a))},[p(f)])])],64)):_("",!0),e.uploading?(u(),d("div",W,[p(v,{type:"circle",percent:e.progress,"stroke-width":2,width:132,"show-info":!1},null,8,["percent"])])):_("",!0)])}],["__scopeId","data-v-aea5d2c8"]]);(ee=X||(X={}))[ee["男"]=1]="男",ee[ee["女"]=2]="女",ee[ee["未知"]=3]="未知";const le=t({name:"PersonalInfo",components:{PwdSet:S,PhoneSet:z,EmailSet:J,AvatarUpload:ae},setup(){const e=r("context"),l=n(""),s=n(!1),t=n({}),o=n(""),i=n(""),u=n({});s.value=!0,e.$http.get("user/info/authed").then((e=>{u.value=a.exports.cloneDeep(e.data),l.value=e.data.headimg,o.value=e.data.phone,i.value=e.data.email,t.value={username:e.data.username,nickname:e.data.nickname,gender:e.data.gender,signature:e.data.signature}})).catch((e=>{console.log(e)})).finally((()=>{s.value=!1}));const d=n(null),p=n(!1);return{headimg:l,oData:u,loadingRef:s,Gender:X,phone:o,email:i,otherForm:t,otherFormRef:d,submitingRef:p,submit:()=>{p.value=!0,e.$http.put("user/"+u.value.id,t.value).then((l=>{e.$message[l.success?"success":"error"](l.message),u.value=a.exports.cloneDeep(l.data)})).catch((e=>{console.log(e)})).finally((()=>{p.value=!1}))},reset:()=>{const e=a.exports.cloneDeep(u.value);t.value={username:e.username,nickname:e.nickname,gender:e.gender,signature:e.signature}}}}}),se=e=>(f("data-v-45ebc56c"),e=e(),v(),e),te={class:"personal-info"},re=se((()=>w("h3",{class:"wrap-title"},"基础信息",-1))),ne={class:"base_avatar"},oe={class:"base_info"},ie={class:"info-item name"},ue={class:"user-base info-item"},de={class:"info-item"},pe={class:"info-item"},ce=se((()=>w("h3",{class:"wrap-title"},"账户信息",-1))),me={class:"wrap-content account"},fe=se((()=>w("label",null,"手机号码：",-1))),ve=se((()=>w("br",null,null,-1))),ge=se((()=>w("label",null,"邮箱：",-1))),we=se((()=>w("br",null,null,-1))),he=se((()=>w("label",null,"登录密码：",-1))),be=se((()=>w("h3",{class:"wrap-title"},"其它信息",-1))),ye=g("男"),_e=g("女"),Re=g("未知"),ke=g(" 重 置 "),Ce=g(" 保存修改 ");var Pe=l(le,[["render",function(e,a,l,s,t,r){const n=i("AvatarUpload"),o=i("a-col"),f=i("ZwIcons"),v=i("a-tag"),b=i("a-row"),_=i("PhoneSet"),R=i("EmailSet"),k=i("PwdSet"),C=i("a-input"),P=i("a-form-item"),F=i("a-radio"),U=i("a-radio-group"),$=i("a-textarea"),S=i("RedoOutlined"),E=i("a-button"),D=i("CheckOutlined"),I=i("a-form"),z=i("a-spin"),A=i("ZwScrollbar");return u(),y(A,{class:"spin-wrap","wrap-class":"pd-17"},{default:c((()=>[p(z,{spinning:e.loadingRef,"wrapper-class-name":"spin-wrap-outer"},{default:c((()=>[w("section",te,[re,p(b,{class:"wrap-content base"},{default:c((()=>[p(o,{xs:24,sm:12,md:8},{default:c((()=>[w("div",ne,[p(n,{class:"base-avatar__set",avatar:e.headimg,"onUpdate:avatar":a[0]||(a[0]=a=>e.headimg=a)},null,8,["avatar"])])])),_:1}),p(o,{xs:24,sm:12,md:16},{default:c((()=>[w("div",oe,[w("p",ie,[p(f,{type:"ant",name:"user-outlined"}),g(" "+h(e.oData.nickname)+" ",1),w("small",null,h(e.oData.account),1)]),w("p",ue,[w("span",{class:j(["gender",{male:1===e.oData.gender,lady:2===e.oData.gender}])},[p(f,{type:"svg",name:"gender"}),g(" "+h(e.Gender[e.oData.gender]),1)],2)]),w("p",de,[(u(!0),d(m,null,x(e.oData.roles,(e=>(u(),y(v,{key:e.id,color:"#2db7f5"},{default:c((()=>[g(h(e.name),1)])),_:2},1024)))),128))]),w("p",pe,h(e.oData.signature||"这个人很懒，很么也没留下！"),1)])])),_:1})])),_:1}),ce,w("div",me,[fe,p(_,{phone:e.phone,"onUpdate:phone":a[1]||(a[1]=a=>e.phone=a)},null,8,["phone"]),ve,ge,p(R,{email:e.email,"onUpdate:email":a[2]||(a[2]=a=>e.email=a)},null,8,["email"]),we,he,p(k,{pwd:e.oData.password,"onUpdate:pwd":a[3]||(a[3]=a=>e.oData.password=a)},null,8,["pwd"])]),be,p(I,{ref:"otherFormRef",model:e.otherForm,"label-col":{span:4},"wrapper-col":{span:20},"label-align":"right",colon:!0,class:"wrap-content form"},{default:c((()=>[p(P,{label:"用户名",name:"username"},{default:c((()=>[p(C,{value:e.otherForm.username,"onUpdate:value":a[4]||(a[4]=a=>e.otherForm.username=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),p(P,{label:"昵称",name:"nickname"},{default:c((()=>[p(C,{value:e.otherForm.nickname,"onUpdate:value":a[5]||(a[5]=a=>e.otherForm.nickname=a),placeholder:"请输入昵称"},null,8,["value"])])),_:1}),p(P,{label:"性别",name:"gerder"},{default:c((()=>[p(U,{value:e.otherForm.gender,"onUpdate:value":a[6]||(a[6]=a=>e.otherForm.gender=a)},{default:c((()=>[p(F,{value:1},{default:c((()=>[ye])),_:1}),p(F,{value:2},{default:c((()=>[_e])),_:1}),p(F,{value:3},{default:c((()=>[Re])),_:1})])),_:1},8,["value"])])),_:1}),p(P,{label:"个性签名",name:"signature"},{default:c((()=>[p($,{value:e.otherForm.signature,"onUpdate:value":a[7]||(a[7]=a=>e.otherForm.signature=a),placeholder:"请输入",row:4},null,8,["value"])])),_:1}),p(P,{"wrapper-col":{xs:{span:24},sm:{span:12,offset:4}}},{default:c((()=>[p(E,{onClick:e.reset,style:{"margin-right":"8px"}},{icon:c((()=>[p(S)])),default:c((()=>[ke])),_:1},8,["onClick"]),p(E,{type:"primary",onClick:e.submit,loading:e.submitingRef},{icon:c((()=>[p(D)])),default:c((()=>[Ce])),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["spinning"])])),_:1})}],["__scopeId","data-v-45ebc56c"]]);export{Pe as default};
