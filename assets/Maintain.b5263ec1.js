var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,d=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&d(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&d(e,t,a[t]);return e},o=(e,a,t)=>new Promise(((l,n)=>{var i=e=>{try{r(t.next(e))}catch(a){n(a)}},d=e=>{try{r(t.throw(e))}catch(a){n(a)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,d);r((t=t.apply(e,a)).next())}));import"./vue.f15e169e.js";import{d as s}from"./dayjs.39b8ebe2.js";import{l as c}from"./lodash.3cabe671.js";import{i as u,c as p,f as _,_ as m,h as f,s as h}from"./index.8318cbd7.js";import{d as v,k as g,l as b,v as k,U as w,_ as y,A as C,$ as x,a2 as I,a3 as D,m as L,a1 as S,J as O,ab as M,a0 as R,z as $,F as P,a7 as V,ae as U,a9 as z,aa as B,W as E,f as j,y as A,w as F,M as T,K as N,h as Y,X as q,s as J,B as K,n as Z,i as H,p as Q,aj as W,S as X,H as G,a4 as ee,ak as ae}from"./@vue.454ad140.js";import{Q as te,P as le}from"./@ant-design.0ba83ffb.js";import{O as ne,i as ie,r as de,d as re}from"./index.37fd2edc.js";const oe=v({name:"MachineItem",emits:["update:itemValue","itemDel","itemBrandValueChange","itemShowProductList","itemChecked"],props:{itemValue:{type:Object,default:()=>({})}},components:{},setup(e,{emit:a,attrs:t}){const l=g("context"),n=b({get:()=>e.itemValue,set(e){a("update:itemValue",e)}}),i=b((()=>Number(t.index)+1)),d=e=>{const a=e?Number(e.split("-")[1]):null;return f(p.value,a)},r=e=>{if(0===e.length)return"";const a=e[e.length-1];return f(p.value,a)},o=b((()=>{const e=n.value;return`\n                机器型号：${d(e.b_all_path)+" - "+r(e.brandValue)||"-"} ;\r\n\n                机身编号：${e.machine_id||"-"} ;\r\n\n                原有故障：${e.r_o_fault||"-"} ;\r\n\n                确认故障：${e.r_fault_desc||"-"} ;\r\n\n                更换配件：${e.r_replace_part||"-"} ;\r\n\n                价格：${e.r_price||"-"} 。\n            `})),s=g("onDMShow"),c=g("deliverSuccess"),m=k(!1),h=b((()=>{const e=l.$store.state.machine.engineers;return e&&e.length>0&&(n.value.u_id||e.forEach((e=>{if(e.default)return n.value.u_id=e.id}))),e}));return u(h.value)&&l.$store.dispatch("machine/get_engineers"),{brandData:p,item:n,index:i,handleDelItem:()=>{a("itemDel",t.index)},fixProblem:_,handleBrandChange:(e,l)=>{const n={b_all_path:"",b_id:null,b_name:""};u(e)||(n.b_all_path=e.join("-"),n.b_id=e[e.length-1],n.b_name=l[e.length-1].b_name),a("itemBrandValueChange",{options:n,index:t.index})},handleSearchPart:e=>{a("itemShowProductList",{index:t.index})},cascaderFilter:(e,a)=>a.some((a=>a.b_name.toLowerCase().indexOf(e.toLowerCase())>-1)),getBrand:d,getModel:r,handleDelPro:e=>{n.value.r_relate_product.splice(e,1)},handleSelectorChange:(e,a)=>{e&&void 0!==e||(n.value[a]=null)},copyData:o,handleDeliver:()=>{s(JSON.stringify([n.value]))},handleCandelDeliver:()=>{l.$modal.confirm({title:"提示",content:"确定要取消发货么？",icon:w(te),okText:"确定",okType:"danger",zIndex:1005,onOk:()=>new Promise(((e,a)=>{l.$http.post("repair/cancel_deliver/"+n.value.r_id).then((t=>{t.success?(l.$message.success(t.message),c(),e(t)):a()})).catch((e=>{a(e)}))}))})},handleCheckboxChange:function(e){a("itemChecked",{index:i.value,checked:e.target.checked})},checked:m,engineers:h}}}),se=e=>(z("data-v-2bafd02d"),e=e(),B(),e),ce={class:"form-table",id:"form-table",cellspacing:"0",cellpadding:"0"},ue={class:"tdw100",colspan:"6"},pe={class:"tools__l"},_e={class:"a-table__row"},me=se((()=>D("td",{class:"tdl tdl3_w"},[D("i",{class:"required"}," * "),O(" 机器型号")],-1))),fe={class:"tdc tdc3_w"},he=se((()=>D("td",{class:"tdl tdl3_w"}," 机器编号 ",-1))),ve={class:"tdc tdc3_w"},ge=se((()=>D("td",{class:"tdl tdl3_w"}," 价格（￥） ",-1))),be={class:"tdc tdc3_w"},ke={class:"a-table__row"},we=se((()=>D("td",{class:"tdl tdl3_w"},"是否同意",-1))),ye={class:"tdc tdc3_w"},Ce=O("同意维修"),xe=O("拒绝维修"),Ie=se((()=>D("td",{class:"tdl tdl3_w"}," 维修状态 ",-1))),De={class:"tdc tdc3_w"},Le=O("已维修"),Se=O("维修中"),Oe=O("原机返"),Me=se((()=>D("td",{class:"tdl tdl3_w"}," 维修人 ",-1))),Re={class:"tdc tdc3_w"},$e={class:"a-table__row"},Pe=se((()=>D("td",{class:"tdl tdl3_w"},"物流名称",-1))),Ve={class:"tdc tdc2_w",colspan:"2"},Ue=se((()=>D("td",{class:"tdl tdl3_w"}," 物流号 ",-1))),ze={class:"tdc tdc2_w",colspan:"2"},Be={class:"a-table__row"},Ee=se((()=>D("td",{class:"tdl tdl3_w"},"随机附件",-1))),je={class:"tdc tdcol5_w",colspan:"5"},Ae={class:"a-table__row"},Fe=se((()=>D("td",{class:"tdl tdl3_w"},[D("i",{class:"required"}," * "),O("原有故障")],-1))),Te={class:"tdc tdcol5_w",colspan:"5"},Ne={class:"a-table__row"},Ye=se((()=>D("td",{class:"tdl tdl3_w"},"确认故障",-1))),qe={class:"tdc tdcol5_w",colspan:"5"},Je={class:"a-table__row"},Ke=se((()=>D("td",{class:"tdl tdl3_w"},"更换配件",-1))),Ze={class:"tdc tdcol5_w",colspan:"5"},He={class:"pro-selector"},Qe={class:"pro-selected-li"},We=se((()=>D("small",null,"       x",-1))),Xe={key:0,class:"isout",style:{color:"green"}},Ge=se((()=>D("span",null,"已出库",-1))),ea={key:1,class:"isout",style:{color:"orange"}},aa=se((()=>D("span",null,"出库失败",-1))),ta={key:2,class:"isout",style:{color:"gray"}},la=se((()=>D("span",null," 待出库 ",-1))),na={key:3,class:"split-btn"},ia=["onClick"],da={class:"a-table__row"},ra=se((()=>D("td",{class:"tdl tdl3_w"},"备注",-1))),oa={class:"tdc tdcol5_w",colspan:"5"};var sa=m(oe,[["render",function(e,a,t,l,n,i){const d=y("a-checkbox"),r=y("a-col"),o=y("ZwIcons"),s=y("a-button"),c=y("a-tooltip"),u=y("CopyTwoTone"),p=y("DeleteTwoTone"),_=y("a-space"),m=y("a-row"),f=y("a-cascader"),h=y("a-input"),v=y("a-select-option"),g=y("a-select"),b=y("a-textarea"),k=y("UnorderedListOutlined"),w=y("a-input-search"),z=y("a-divider"),B=y("CheckCircleOutlined"),E=y("ExclamationCircleOutlined"),j=y("ClockCircleOutlined"),A=y("CloseCircleOutlined"),F=C("clipboard");return x(),I("table",ce,[D("tr",null,[D("td",ue,[L(m,{class:"tools"},{default:S((()=>[L(r,{span:12},{default:S((()=>[D("div",pe,[L(d,{checked:e.checked,"onUpdate:checked":a[0]||(a[0]=a=>e.checked=a),onChange:e.handleCheckboxChange},{default:S((()=>[O(M(e.index)+" -- "+M(e.item.r_id),1)])),_:1},8,["checked","onChange"])])])),_:1}),L(r,{span:12},{default:S((()=>[L(_,{class:"tools__r",size:0},{default:S((()=>[1==e.item.r_is_deliver?(x(),R(c,{key:0,title:"取消发货"},{default:S((()=>[L(s,{type:"link",class:"candel-deliver",onClick:e.handleCandelDeliver},{default:S((()=>[L(o,{name:"fahuo",type:"svg"})])),_:1},8,["onClick"])])),_:1})):(x(),R(c,{key:1,title:"去发货"},{default:S((()=>[L(s,{type:"link",onClick:e.handleDeliver},{default:S((()=>[L(o,{name:"fahuo",type:"svg"})])),_:1},8,["onClick"])])),_:1})),L(c,{title:"复制数据"},{default:S((()=>[$((x(),R(s,{type:"link"},{default:S((()=>[L(u)])),_:1})),[[F,e.copyData]])])),_:1}),L(c,{title:"删除此项"},{default:S((()=>[L(s,{type:"link",onClick:e.handleDelItem},{default:S((()=>[L(p,{twoToneColor:"#ff4d4f"})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])]),D("tr",_e,[me,D("td",fe,[L(f,{value:e.item.brandValue,"onUpdate:value":a[1]||(a[1]=a=>e.item.brandValue=a),options:e.brandData,"field-names":{label:"b_name",value:"b_id"},"get-popup-container":e.fixProblem,"expand-trigger":"hover","change-on-select":"","show-search":{filter:e.cascaderFilter},placeholder:"选择品牌型号",onChange:e.handleBrandChange},null,8,["value","options","get-popup-container","show-search","onChange"])]),he,D("td",ve,[L(h,{type:"text",value:e.item.machine_id,"onUpdate:value":a[2]||(a[2]=a=>e.item.machine_id=a),placeholder:"机器编号"},null,8,["value"])]),ge,D("td",be,[L(h,{type:"text",value:e.item.r_price,"onUpdate:value":a[3]||(a[3]=a=>e.item.r_price=a),name:"r_price"},null,8,["value"])])]),D("tr",ke,[we,D("td",ye,[L(g,{value:e.item.r_is_repair,"onUpdate:value":a[4]||(a[4]=a=>e.item.r_is_repair=a),name:"r_is_repair",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem,onChange:a[5]||(a[5]=a=>e.handleSelectorChange(a,"r_is_repair"))},{default:S((()=>[L(v,{value:1},{default:S((()=>[Ce])),_:1}),L(v,{value:2},{default:S((()=>[xe])),_:1})])),_:1},8,["value","get-popup-container"])]),Ie,D("td",De,[L(g,{value:e.item.r_repair_status,"onUpdate:value":a[6]||(a[6]=a=>e.item.r_repair_status=a),name:"r_repair_status",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem,onChange:a[7]||(a[7]=a=>e.handleSelectorChange(a,"r_repair_status"))},{default:S((()=>[L(v,{value:1},{default:S((()=>[Le])),_:1}),L(v,{value:2},{default:S((()=>[Se])),_:1}),L(v,{value:3},{default:S((()=>[Oe])),_:1})])),_:1},8,["value","get-popup-container"])]),Me,D("td",Re,[L(g,{value:e.item.u_id,"onUpdate:value":a[8]||(a[8]=a=>e.item.u_id=a),name:"u_id",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem},{default:S((()=>[(x(!0),I(P,null,V(e.engineers,(e=>(x(),R(v,{key:e.id,value:e.id},{default:S((()=>[O(M(e.realname||e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","get-popup-container"])])]),D("tr",$e,[Pe,D("td",Ve,[L(h,{type:"text",value:e.item.logistics_name,"onUpdate:value":a[9]||(a[9]=a=>e.item.logistics_name=a),name:"logistics_name",placeholder:"物流名称"},null,8,["value"])]),Ue,D("td",ze,[L(h,{type:"text",placeholder:"物流单号",value:e.item.logistics_num,"onUpdate:value":a[10]||(a[10]=a=>e.item.logistics_num=a),name:"logistics_num"},null,8,["value"])])]),D("tr",Be,[Ee,D("td",je,[L(h,{type:"text",value:e.item.affix,"onUpdate:value":a[11]||(a[11]=a=>e.item.affix=a),name:"affix",placeholder:"随机附带的配件"},null,8,["value"])])]),D("tr",Ae,[Fe,D("td",Te,[L(b,{value:e.item.r_o_fault,"onUpdate:value":a[12]||(a[12]=a=>e.item.r_o_fault=a),name:"r_o_fault",placeholder:"输入机器原始故障","auto-size":{minRows:2}},null,8,["value"])])]),D("tr",Ne,[Ye,D("td",qe,[L(b,{value:e.item.r_fault_desc,"onUpdate:value":a[13]||(a[13]=a=>e.item.r_fault_desc=a),name:"r_fault_desc",placeholder:"确认机器故障","auto-size":{minRows:2}},null,8,["value"])])]),D("tr",Je,[Ke,D("td",Ze,[D("div",He,[L(w,{value:e.item.r_replace_part,"onUpdate:value":a[14]||(a[14]=a=>e.item.r_replace_part=a),placeholder:"更换配件说明, 点击右侧按钮选择关联配件",onSearch:e.handleSearchPart},{enterButton:S((()=>[L(s,{style:{"background-color":"#f2f2f2"}},{default:S((()=>[L(k)])),_:1})])),_:1},8,["value","onSearch"]),L(z),D("ol",Qe,[(x(!0),I(P,null,V(e.item.r_relate_product,((a,t)=>(x(),I("li",{key:a.p_id},[O(M(t+1)+". "+M(e.getBrand(a.b_all_path))+" - "+M(a.b_name||e.getModel(a.b_all_path.split("-")))+" - "+M(a.f_name)+" ",1),We,O(" "+M(a.num)+" ",1),2==a.isOut?(x(),I("span",Xe,[L(B),Ge])):3==a.isOut?(x(),I("span",ea,[L(E),aa])):(x(),I("span",ta,[L(j),la])),2===e.item.r_is_deliver?(x(),I("span",na,[D("span",{style:{color:"red",cursor:"pointer"},onClick:a=>e.handleDelPro(t)},[L(A)],8,ia)])):U("",!0)])))),128))])])])]),D("tr",da,[ra,D("td",oa,[L(b,{value:e.item.r_mark,"onUpdate:value":a[15]||(a[15]=a=>e.item.r_mark=a)},null,8,["value"])])])])}],["__scopeId","data-v-2bafd02d"]]);const ca=v({name:"ListModal",emits:["update:visible","ensure"],components:{},props:{visible:{type:Boolean,default:!1},keywords:{type:String,default:""},zIndexModel:{type:Number,default:1e3}},setup(e,{emit:a}){const t=k(null),l=function(){a("update:visible",!1)};return{listdata:t,columns:[{title:"品牌",dataIndex:["b","b_all_path"],width:118,align:"center",customRender:({text:e})=>{const a=e?Number(e.split("-")[1]):null;return f(p.value,a)}},{title:"型号",dataIndex:["b","b_name"],width:118,align:"center"},{title:"配件名称",dataIndex:["f","f_name"],align:"center",width:152},{title:"总数",dataIndex:"p_total_num",align:"center",width:72},{title:"状态",dataIndex:"p_state",width:72,align:"center",customRender:({text:e})=>w(y("a-tag"),{color:1===e?"blue":"orange"},{default:()=>1===e?"正常":"处理"})},{title:"操作",dataIndex:"selection",width:108,align:"center"}],handleCancel:l,handleOk:function(){const e=t.value.getSelectedRows();a("ensure",e),l()}}}}),ua=O("取消 "),pa=O("确定 ");var _a=v({name:"FormModal",components:{PlusOutlined:le,MItem:sa,ListModal:m(ca,[["render",function(e,a,t,l,n,i){const d=y("ListData"),r=y("CloseOutlined"),o=y("a-button"),s=y("CheckOutlined"),c=y("zwModal");return x(),R(c,E({visible:e.visible,closable:!1},e.$attrs),{footer:S((()=>[L(o,{key:"back",onClick:e.handleCancel},{icon:S((()=>[L(r)])),default:S((()=>[ua])),_:1},8,["onClick"]),L(o,{key:"submit",type:"primary",onClick:e.handleOk},{icon:S((()=>[L(s)])),default:S((()=>[pa])),_:1},8,["onClick"])])),default:S((()=>[L(d,{ref:"listdata",keywords:e.keywords,columns:e.columns,rowKey:"p_id",apis:{query:"product",add:"product"},"dynamic-form":"ProductForm","z-index":e.zIndexModel+1,"can-select":!0},null,8,["keywords","columns","z-index"])])),_:1},16,["visible"])}]])},props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})}},setup(e,{emit:a}){const t=g("context"),l=k(!1),n=k(!1),i=k(!1),d="YYYY-MM-DD HH:mm:ss",r=j({order:"",c_id:null,c_name:"",receipt_date:s(),mark:"",sum_price:0,delDatas:null,list:[c.exports.cloneDeep(ne)]}),p=k([]);const m=j({checkedIndexs:[],indeterminate:!1,checkedAll:!1}),f=({index:e,checked:a})=>{const t=m.checkedIndexs,l=t.includes(e);a?!l&&t.push(e):l&&t.splice(t.findIndex((a=>a===e),1))},v=k(!0);function y(e,a){return o(this,null,(function*(){if("add"!==a&&e){let o,c;l.value=!0,"editSingle"===a?(o=yield(i=e.r_id,new Promise(((e,a)=>{t.$http.get("repair/"+i).then((t=>{t.success?e(t.data):a(t.message)})).catch((e=>{a(e)}))}))),c=[o]):(o=yield(n=e.r_order,new Promise(((e,a)=>{t.$http.get("repair_order/"+n).then((t=>{t.success?e(t.data):a(t.message)})).catch((e=>{a(e)}))}))),c=o.rs),l.value=!1,o.rs&&q(o.rs)?(r.order=o.order,r.c_id=o.c_id,r.c_name=o.c_name,r.receipt_date=s(o.receipt_date,d),r.mark=o.mark||""):(r.order=o.ro.order,r.c_id=o.ro.c_id,r.c_name=o.ro.c_name,r.receipt_date=s(o.ro.receipt_date,d),r.mark=o.ro.mark||""),r.list=c.map((e=>{const a=e.brand.b_all_path;return e.b_all_path=a,e.b_id=e.brand.b_id,e.b_name=e.brand.b_name,a&&(e.brandValue=a.split("-").map((e=>Number(e)))),e}))}else r.receipt_date=s(),r.list=[c.exports.cloneDeep(ne)];var n,i}))}A((()=>{e.visible&&y(e.formData.record,e.formData.mode)}));const C=c.exports.throttle((()=>{r.list.push(c.exports.cloneDeep(ne))}),200),x=c.exports.throttle((e=>{if(r.list.length<=1)return t.$message.warn("已经是最后一条数据了");t.$modal.confirm({title:"删除提示",content:w("div",{},`此操作将删除第 ${e+1} 条数据，是否继续？`),icon:w(te),okText:"确定",okType:"danger",zIndex:1005,onOk(){const a=r.list.splice(e,1);a[0].r_id&&(r.delDatas||(r.delDatas=[]),r.delDatas.push(a[0].r_id))}})}),500);F((()=>m.checkedIndexs),(e=>{m.indeterminate=!!e.length&&e.length<r.list.length,m.checkedAll=e.length===r.list.length}),{deep:!0});const{indeterminate:I,checkedAll:D}=T(m),L=g("onDMShow"),S=k("");N((()=>{p.value=[]}));const O=k(null),M=b((()=>null!==O.value&&O.value>=0?r.list[O.value].b_name:""));function R(){return n.value=!0,new Promise(((a,l)=>{if(!function(){if(!r.c_id)return t.$message.warning("请选择客户"),!1;if(!r.list||r.list.length<=0)return t.$message.warning("维修列表不能为空"),!1;let e=0;return r.list.forEach(((a,l)=>{const n=a.r_relate_product;u(n)&&(a.r_relate_product=""),a.brandValue.length&&a.r_o_fault||(e++,t.$message.warning({content:w("span",{style:"color: #E6A23C; margin-left: 20px"},[w("b",{style:"color: #f00"},"* "),w("small",null,"为必填项, 请完善第 "),w("b",{style:"color: #f00"},l+1),w("small",null," 条数据")]),duration:2+.5*l,icon:w(te)}))})),s.isDayjs(r.receipt_date)&&(r.receipt_date=r.receipt_date&&r.receipt_date.format(d)),0===e}())return n.value=!1,l();const i=e.formData.mode;let o="repair";"edit"!==i&&"editSingle"!==i||(o="repair/"+r.order),t.$http({url:o,method:"add"===i?"POST":"PUT",data:r}).then((e=>{e.success?a(e):(t.$message.error(e.message),l(e.message))})).catch((e=>{l(e)}))}))}Y((()=>{C.cancel(),x.cancel()}));return{dateFormat:d,loadingList:l,confirmLoading:n,showListModal:i,mIndex:O,keywords:M,foo:r,handleAdd:C,handleModalOk:()=>{R().then((e=>{t.$message.success(e.message),a("listreload")})).finally((()=>{n.value=!1}))},modalClosed:()=>{r.order=null,r.c_id=null,r.c_name="",r.mark="",r.delDatas=null,r.receipt_date=null,r.sum_price=0,r.list=[c.exports.cloneDeep(ne)],m.indeterminate=!1,p.value.forEach((e=>{e.checked=!1,f({index:e.index,checked:!1})}))},handleDelItem:x,staffData:h,fixProblem:_,staffSelect:(e,a)=>{r.c_name=a.title},handleBrandValueChange:({options:e,index:a})=>{Object.assign(r.list[a],e)},handleShowProductList:({index:e})=>{O.value=e,i.value=!0},handleProductSelected:e=>{const a=[...r.list[O.value].r_relate_product],t=[...a];e.forEach((e=>{a.some((a=>a.p_id===e.p_id))||t.push({p_id:e.p_id,f_id:e.f_id,b_all_path:e.b.b_all_path,f_name:e.f.f_name,repair_price:e.repair_price,b_name:e.b.b_name,num:1,isOut:0})})),r.list[O.value].r_relate_product=u(t)?"":t},onItemChecked:f,checkedAll:D,indeterminate:I,handleAllChecked:function(e){m.indeterminate=!1;const a=e.target.checked;p.value.forEach((e=>{e.checked=a,f({index:e.index,checked:a})}))},mItems:p,handleDeliver:function(){if(u(m.checkedIndexs))return t.$message.warn("请选择需要发货的机器");L(JSON.stringify(m.checkedIndexs.map((e=>r.list[e-1]))))},copydata:S,handleCopyList:function(e){if(e.preventDefault||e.cancelBubble,S.value="",u(m.checkedIndexs))return t.$message.warn("请选择需要复制的机器信息");p.value.forEach(((e,a)=>{e.checked&&(S.value+=e.copyData+"\r\n\r\n")}))},canEdit:v}}});const ma=e=>(z("data-v-69dad64f"),e=e(),B(),e),fa={class:"form-table",cellspacing:"0",cellpadding:"0"},ha=ma((()=>D("td",{class:"tdl tdl2_w"},[D("i",{class:"required"}," * "),O(" 客户")],-1))),va={class:"tdc tdc2_w"},ga=ma((()=>D("td",{class:"tdl tdl2_w"}," 收货时间 ",-1))),ba={class:"tdc tdc2_w"},ka=ma((()=>D("td",{class:"tdl tdl_w"},"备注",-1))),wa={class:"tdc tdc_w",colspan:"3"},ya=O(" 维修机清单： 共 "),Ca=O(" 台 "),xa=O(" 全选 "),Ia={class:"tools-bar-btns"},Da=O("发货"),La=O("复制信息"),Sa=O(" 添 加 机 器 ");var Oa=m(_a,[["render",function(e,a,t,l,n,i){const d=y("a-select-option"),r=y("a-select"),o=y("a-form-item"),s=y("a-date-picker");y("a-input");const c=y("a-textarea"),u=y("a-divider"),p=y("a-checkbox"),_=y("a-col"),m=y("a-button"),f=y("a-row"),h=y("MItem"),v=y("a-spin"),g=y("PlusOutlined"),b=y("a-form"),k=y("a-modal"),w=y("ListModal"),z=C("can-edit"),B=C("clipboard");return x(),I(P,null,[L(k,E({visible:e.visible,title:"维修机"},e.$attrs,{"confirm-loading":e.confirmLoading,"z-index":100,"after-close":e.modalClosed,onOk:e.handleModalOk}),{default:S((()=>[L(b,{ref:"MachineForm",model:e.foo,class:"machine-form","label-col":{span:0},"wrapper-col":{span:24}},{default:S((()=>[D("table",fa,[D("tr",null,[ha,D("td",va,[L(o,{name:"c_id"},{default:S((()=>[$((x(),R(r,{value:e.foo.c_id,"onUpdate:value":a[0]||(a[0]=a=>e.foo.c_id=a),placeholder:"请选择","show-search":"",allowClear:"","option-filter-prop":"title","get-popup-container":e.fixProblem,onSelect:e.staffSelect},{default:S((()=>[(x(!0),I(P,null,V(e.staffData,(e=>(x(),R(d,{key:e.c_id,value:e.c_id,title:e.c_name},{default:S((()=>[O(M(e.c_name),1)])),_:2},1032,["value","title"])))),128))])),_:1},8,["value","get-popup-container","onSelect"])),[[z,e.canEdit]])])),_:1})]),ga,D("td",ba,[L(s,{value:e.foo.receipt_date,"onUpdate:value":a[1]||(a[1]=a=>e.foo.receipt_date=a),"show-Time":"","allow-clear":"","value-format":e.dateFormat,format:e.dateFormat,getPopupContainer:e.fixProblem},null,8,["value","value-format","format","getPopupContainer"])])]),U("",!0),D("tr",null,[ka,D("td",wa,[L(o,{name:"mark"},{default:S((()=>[L(c,{value:e.foo.mark,"onUpdate:value":a[2]||(a[2]=a=>e.foo.mark=a),placeholder:"备注信息"},null,8,["value"])])),_:1})])])]),L(u,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:S((()=>[D("span",null,[ya,D("strong",null,M(e.foo.list.length),1),Ca])])),_:1}),e.foo.list.length>1?(x(),R(f,{key:0,class:"tools-bar"},{default:S((()=>[L(_,{class:"tools-bar-left",span:10},{default:S((()=>[L(p,{checked:e.checkedAll,"onUpdate:checked":a[3]||(a[3]=a=>e.checkedAll=a),indeterminate:e.indeterminate,onChange:e.handleAllChecked},{default:S((()=>[xa])),_:1},8,["checked","indeterminate","onChange"])])),_:1}),L(_,{span:14},{default:S((()=>[D("div",Ia,[L(m,{onClick:e.handleDeliver},{default:S((()=>[Da])),_:1},8,["onClick"]),$((x(),R(m,{onClick:e.handleCopyList},{default:S((()=>[La])),_:1},8,["onClick"])),[[B,e.copydata]])])])),_:1})])),_:1})):U("",!0),L(v,{spinning:e.loadingList},{default:S((()=>[L(J,{name:"slide-fade",tag:"div"},{default:S((()=>[(x(!0),I(P,null,V(e.foo.list,((a,t)=>(x(),R(h,{key:t,ref_for:!0,ref:a=>{a&&(e.mItems[t]=a)},itemValue:e.foo.list[t],"onUpdate:itemValue":a=>e.foo.list[t]=a,index:t,onItemDel:e.handleDelItem,onItemBrandValueChange:e.handleBrandValueChange,onItemShowProductList:e.handleShowProductList,onItemChecked:e.onItemChecked},null,8,["itemValue","onUpdate:itemValue","index","onItemDel","onItemBrandValueChange","onItemShowProductList","onItemChecked"])))),128))])),_:1})])),_:1},8,["spinning"]),"add"===e.formData.mode||"edit"===e.formData.mode?(x(),R(m,{key:1,block:"",onClick:e.handleAdd},{default:S((()=>[L(g),Sa])),_:1},8,["onClick"])):U("",!0)])),_:1},8,["model"])])),_:1},16,["visible","confirm-loading","after-close","onOk"]),L(w,{visible:e.showListModal,"onUpdate:visible":a[4]||(a[4]=a=>e.showListModal=a),width:860,title:"产品列表选择","z-index-model":1101,"mask-closable":!1,keywords:e.keywords,onEnsure:e.handleProductSelected},null,8,["visible","keywords","onEnsure"])],64)}],["__scopeId","data-v-69dad64f"]]);var Ma=m(v({name:"ColsInput",props:["fields","order","fieldsValue","placeholder","id"],setup(e,{emit:a}){const t=k("");F((()=>e.fieldsValue),(e=>{t.value=e}),{immediate:!0});const l=k(!0),n=k(null);return K((()=>{})),{val:t,aInput:n,handleModify:()=>{l.value=!0,a("colsInputBlur",{id:e.id,value:t.value,fields:e.fields,order:e.order})},isReadonly:l,handleEdit:()=>{l.value=!1,Z((()=>{n.value.focus()}))}}}}),[["render",function(e,a,t,l,n,i){const d=y("EditOutlined"),r=y("a-input");return x(),R(r,{ref:"aInput",value:e.val,"onUpdate:value":a[1]||(a[1]=a=>e.val=a),disabled:e.isReadonly,placeholder:e.placeholder,size:"small",onBlur:e.handleModify,tabindex:e.id},{suffix:S((()=>[L(d,{onClick:a[0]||(a[0]=a=>e.handleEdit()),style:{color:"rgba(0, 0, 0, 0.65)",cursor:"pointer"}})])),_:1},8,["value","disabled","placeholder","onBlur","tabindex"])}],["__scopeId","data-v-23e1ce4e"]]);const Ra=v({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:a}){const t=g("context");return{val:b({get:()=>e.fieldsValue,set(e){a("update:fieldsValue",e)}}),handleChage:l=>{t.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:l}]}).then((e=>{t.$message.success(e.message),a("reload")}))}}}}),$a=O(" 同意 "),Pa=O(" 拒绝 ");var Va=m(Ra,[["render",function(e,a,t,l,n,i){const d=y("a-select-option"),r=y("a-select");return x(),R(r,{value:e.val,"onUpdate:value":a[0]||(a[0]=a=>e.val=a),placeholder:"请选择",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:S((()=>[L(d,{value:1},{default:S((()=>[$a])),_:1}),L(d,{value:2},{default:S((()=>[Pa])),_:1})])),_:1},8,["value","onChange"])}]]);const Ua=v({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:a}){const t=g("context");return{val:b({get:()=>e.fieldsValue,set(e){a("update:fields-value",e)}}),handleChage:l=>{t.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:l}]}).then((e=>{t.$message.success(e.message),a("reload")}))}}}}),za=O(" 已维修 "),Ba=O(" 维修中 "),Ea=O(" 原机返 ");var ja=m(Ua,[["render",function(e,a,t,l,n,i){const d=y("a-select-option"),r=y("a-select");return x(),R(r,{value:e.val,"onUpdate:value":a[0]||(a[0]=a=>e.val=a),placeholder:"请选择",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:S((()=>[L(d,{value:1},{default:S((()=>[za])),_:1}),L(d,{value:2},{default:S((()=>[Ba])),_:1}),L(d,{value:3},{default:S((()=>[Ea])),_:1})])),_:1},8,["value","onChange"])}]]);function Aa({text:e}){return e?e.substring(2,11):"--"}const Fa=e=>[{title:"收货日期",dataIndex:"receipt_date",width:72,align:"center",customRender:Aa},{title:"姓名",dataIndex:"c_name",width:86,align:"center",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.clientCellClick(a,t,l)}})},{title:"型号",dataIndex:"b_name",width:86,align:"center"},{title:"原故障",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"确认故障",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})},{title:"更换配件",dataIndex:"r_replace_part",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})}],Ta=e=>[{title:"型号",dataIndex:"b_name",width:86,align:"center"},{title:"原故障",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"确认故障",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})},{title:"更换配件",dataIndex:"r_replace_part",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})}],Na=e=>[{title:"价格(￥)",dataIndex:"r_price",width:86,customRender:({record:a,text:t})=>w(Ma,{fields:"r_price",fieldsValue:t,id:a.r_id,placeholder:"维修价格",order:a.r_order,onColsInputBlur:e.colInputBlur})},{title:"是否维修",dataIndex:"r_is_repair",width:96,align:"center",customRender:({record:a,text:t})=>w(Va,{fields:"r_is_repair",fieldsValue:t,order:a.r_order,"data-id":a.r_id,onReload:e.reload})},{title:"维修状态",dataIndex:"r_repair_status",width:96,align:"center",customRender:({record:a,text:t})=>w(ja,{fields:"r_repair_status",fieldsValue:t,order:a.r_order,"data-id":a.r_id,onReload:e.reload})},{title:"机器编号",dataIndex:"machine_id",width:132,customRender:({record:a,text:t})=>w(Ma,{class:"ipt-font-bold",fields:"machine_id",fieldsValue:t,id:a.r_id,order:a.r_order,placeholder:"机器编号",onColsInputBlur:e.colInputBlur})}];var Ya={totalColumns:e=>[...Fa(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ie},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:de},{title:"发货",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:re},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"操作",dataIndex:"action",width:72,align:"center"}],todoColumns:e=>[...Fa(e),...Na(e),{title:"操作",dataIndex:"action",width:72,align:"center"}],doneColumns:e=>[{title:"发货日期",dataIndex:"r_delivery_date",key:"r_delivery_date",width:72,align:"center",customRender:Aa},...Fa(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ie},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:de},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"操作",dataIndex:"action",width:72,align:"center"}]};const qa=v({name:"ClientRepairList",components:{},props:{visible:{type:Boolean,default:!1},formdata:{type:Object,default:()=>({})}},setup(e,{emit:a}){const t=g("context"),l=g("reload"),n=b((()=>{const e=t.$route.path;return e.includes("todo")?2:e.includes("done")?1:0})),i=k(0),d=(e,t,l)=>{a("showFormModal",{record:e,index:t,e:l})},r=2===n.value?[...Ta(s={customCellClick:d,colInputBlur(e){t.$http.put("repair/"+e.order,{order:e.order,list:[{r_id:e.id,[e.fields]:e.value}]}).then((e=>{t.$message.success(e.message),l()}))},reload:l}),...Na(s)]:(e=>[...Ta(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ie},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:de},{title:"发货",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:re},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0}])({customCellClick:d,reload:l});var s;const c=k(null),p=k(0),_=k("");return F((()=>e.visible),(e=>{e||(i.value=0)})),{isDeliverRef:n,columns:r,ListDataRefs:c,refresh:()=>o(this,null,(function*(){yield c.value.handleReload()})),sumPriceRef:i,beforeListdataLoad:a=>{a.c_id=e.formdata["ro.c_id"],a.deliver=n.value||null},count:p,onListdataLoaded:e=>{p.value=e.data.count},handleToolsbarAction:function(e,l){const n=c.value.getSelectedRows();if(u(n))return l.stopPropagation||l.cancelBubble,t.$message.warn("请先选择数据！！！");"copy"===e&&(_.value="",n.forEach((e=>{_.value+=`机器型号：${e.b_name}\r\n机身编码：${e.machine_id}\r\n原有故障：${e.r_o_fault}\r\n确认故障：${e.r_fault_desc}\r\n更换配件：${e.r_replace_part}\r\n价格：${e.r_price}\r\n\r\n`}))),"diliver"===e&&a("showDeliverModal",JSON.stringify(n))},copyData:_,handleCancel:function(){a("update:visible",!1)},handleOk:()=>{a("update:visible",!1)},onListdataSelect:e=>{i.value=e.reduce(((e,a)=>e+Number(a.r_price)),0)}}}}),Ja=e=>(z("data-v-695e280b"),e=e(),B(),e),Ka={class:"form-table",cellspacing:"0",cellpadding:"0"},Za=Ja((()=>D("td",{class:"tdl tdl2_w"},"客户名称",-1))),Ha={class:"tdc tdc2_w"},Qa=Ja((()=>D("td",{class:"tdl tdl2_w"}," 联系方式 ",-1))),Wa={class:"tdc tdc2_w"},Xa=O(" 维修机列表 "),Ga=O(" 合计："),et=Ja((()=>D("small",null,"￥",-1))),at=O(),tt=O(" 元 "),lt={class:"tools"},nt=O(" 复制 "),it=Ja((()=>D("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[D("path",{d:"M957.152011 169.189354c0-35.162848-28.760021-63.814398-64.031339-63.814398l-500.744655 0c-35.272341 0-64.031339 28.65155-64.031339 63.814398l0 105.705484c0 1.735527-0.759293 3.146667-2.279926 3.90596l-176.736237 92.89983c-49.867758 26.155706-82.48155 77.488839-82.48155 133.813658l0 320.0472 133.867894 0c0 0.10847 0 0.10847 0 0.162706l1.194198 0c11.883655 53.123918 59.147098 92.89983 115.852588 92.89983s103.969956-39.775912 115.853611-92.89983l1.465374 0c0.054235-0.054235 0.054235-0.054235 0.054235-0.162706l150.311401 0c0 0.10847 0 0.10847 0 0.162706l5.426593 0c11.93789 53.123918 59.147098 92.89983 115.906823 92.89983 56.760748 0 104.078427-39.830147 115.907846-93.062536l134.465504 0L957.153034 169.189354zM317.761646 863.058494c-34.944883 0-63.380516-28.434609-63.380516-63.380516s28.434609-63.380516 63.380516-63.380516c34.945907 0 63.381539 28.434609 63.381539 63.380516S352.708576 863.058494 317.761646 863.058494zM706.77866 863.058494c-34.944883 0-63.379493-28.434609-63.379493-63.380516s28.433586-63.380516 63.379493-63.380516c34.945907 0 63.380516 28.434609 63.380516 63.380516S741.724567 863.058494 706.77866 863.058494zM901.585461 769.995959l-80.093153 0c-13.240559-51.225685-59.365062-89.264023-114.714671-89.264023-55.402821 0-101.58156 38.039361-114.821095 89.264023L432.530552 769.995959c-13.239536-51.225685-59.365062-89.264023-114.767883-89.264023-55.402821 0-101.527324 38.039361-114.76686 89.264023l-80.58127 0L122.414539 505.514285c0-35.108612 20.239973-67.503417 52.798507-84.650959l175.705767-92.356454c20.402679-10.148128 32.992415-30.713512 32.992415-53.613058L383.911228 169.189354c0-4.450359 3.90596-8.248871 8.464789-8.248871l500.744655 0c4.557806 0 8.464789 3.798513 8.464789 8.248871L901.585461 769.995959z","p-id":"4974"}),D("path",{d:"M372.460432 382.499577c-15.356756 0-27.782763 12.426007-27.782763 27.78174l0 138.91484L205.761805 549.196157c-15.356756 0-27.782763 12.42703-27.782763 27.782763s12.42703 27.782763 27.782763 27.782763l166.697603 0c15.356756 0 27.782763-12.42703 27.782763-27.782763L400.242172 410.282341C400.243195 394.925584 387.816165 382.499577 372.460432 382.499577z","p-id":"4975"})],-1))),dt=O(" 发货 "),rt=Ja((()=>D("span",null,null,-1))),ot=O("取 消 "),st=O("确 定 ");var ct=m(qa,[["render",function(e,a,t,l,n,i){const d=y("a-divider"),r=y("a-col"),o=y("CopyOutlined"),s=y("a-button"),c=y("Icon"),u=y("a-row"),p=y("ListData"),_=y("CloseOutlined"),m=y("CheckOutlined"),f=y("ZwModal"),h=C("clipboard");return x(),R(f,E({visible:e.visible},e.$attrs),{footer:S((()=>[L(s,{key:"back",onClick:e.handleCancel},{icon:S((()=>[L(_)])),default:S((()=>[ot])),_:1},8,["onClick"]),L(s,{key:"submit",type:"primary",onClick:e.handleOk},{icon:S((()=>[L(m)])),default:S((()=>[st])),_:1},8,["onClick"])])),default:S((()=>[D("table",Ka,[D("tr",null,[Za,D("td",Ha,M(e.formdata.c_name),1),Qa,D("td",Wa,M(e.formdata.c_phone),1)])]),L(d,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:S((()=>[D("span",null,[Xa,D("b",null,"共 "+M(e.count)+" 台",1)])])),_:1}),L(u,{class:"tools-bar"},{default:S((()=>[L(r,{span:4},{default:S((()=>[Ga,et,at,D("b",null,M(e.sumPriceRef),1),tt])),_:1}),L(r,{span:20},{default:S((()=>[D("div",lt,[$((x(),R(s,{onClick:a[0]||(a[0]=a=>e.handleToolsbarAction("copy",a))},{default:S((()=>[L(o),nt])),_:1})),[[h,e.copyData]]),2===e.isDeliverRef?(x(),R(s,{key:0,style:{"margin-left":"8px"},onClick:a[1]||(a[1]=a=>e.handleToolsbarAction("diliver",a))},{default:S((()=>[L(c,null,{component:S((()=>[it])),_:1}),dt])),_:1})):U("",!0)])])),_:1})])),_:1}),e.visible?(x(),R(p,{key:0,ref:"ListDataRefs",columns:e.columns,size:"small",bordered:"",rowKey:"r_id",apis:{query:"repair"},"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataLoaded:e.onListdataLoaded,onListdataSelect:e.onListdataSelect},{topTools:S((()=>[rt])),_:1},8,["columns","before-listdata-load","onListdataLoaded","onListdataSelect"])):U("",!0)])),_:1},16,["visible"])}],["__scopeId","data-v-695e280b"]]);const ut=v({name:"DeliverModal",props:{visible:{type:Boolean,default:!1},formdata:{type:Array,default:()=>[]},cid:{type:Number,default:null}},setup(e,{emit:a}){const t=g("context");k({tracking_num:"",delivery_date:""});const l=function(){a("update:visible",!1)},n=g("deliverSuccess");const i=k(!1);return{getBrand:e=>{const a=e?Number(e.split("-")[1]):null;return f(p.value,a)},getModel:e=>{if(0===e.length)return"";const a=e[e.length-1];return f(p.value,a)},handleCancel:l,submiting:i,handleOk:a=>{const d=e.formdata;if(!d&&d.length<=0)return t.$message.error("发货列表为空！");i.value=!0;const o={},s={};d.forEach((e=>{s.list||(s.list=[]),o.list||(o.list=[]);const a=e.r_relate_product,t=[],l=!u(a)&&H(a)?JSON.parse(a):q(a)?a:[];1!==e.r_is_repair||u(l)||(l.forEach((a=>{2!==a.isOut&&(a.io_num=a.num,a.o_type=1,a.o_state=1,a.r_id=e.r_id,a.isOut=2,t.push(a))})),o.list.push(...t)),o.mold=1,o.c_id=e["ro.c_id"],s.list.push(Object.assign(r({},e),{r_is_deliver:1,r_relate_product:t.length>0?t:l})),s.order=e.r_order}));const c={repair:s,io:o};1===a&&delete c.io,t.$http.post("repair/deliver",c).then((e=>{e.success?t.$modal.success({title:"发货成功！",content:"",zIndex:1009,onOk(){l(),n()}}):t.$message.error("发货失败！")})).catch((e=>{console.log(e)})).finally((()=>{i.value=!1}))},relateProductDeal:function(e){return e&&"string"==typeof e?JSON.parse(e):e}}}}),pt={style:{"margin-bottom":"unset"}},_t=D("small",null,"       x",-1),mt={key:0,class:"isout"},ft=D("span",null,"出库中...",-1),ht={key:1,class:"isout",style:{color:"green"}},vt=D("span",null,"已出库",-1),gt={key:2,class:"isout",style:{color:"orange"}},bt=D("span",null,"出库失败",-1),kt={key:3,class:"isout",style:{color:"gray"}},wt=D("span",null," 待出库 ",-1),yt=O("取 消 "),Ct=O("发 货 "),xt=O("发货并出库 ");var It=m(ut,[["render",function(e,a,t,l,n,i){const d=y("a-table-column"),r=y("LoadingOutlined"),o=y("CheckCircleOutlined"),s=y("ExclamationCircleOutlined"),c=y("ClockCircleOutlined"),u=y("a-table"),p=y("CloseOutlined"),_=y("a-button"),m=y("CheckOutlined"),f=y("ZwModal");return x(),R(f,E({visible:e.visible},e.$attrs),{footer:S((()=>[L(_,{key:"back",onClick:e.handleCancel},{icon:S((()=>[L(p)])),default:S((()=>[yt])),_:1},8,["onClick"]),L(_,{key:"submit",type:"primary",onClick:a[0]||(a[0]=a=>e.handleOk(1)),loading:e.submiting},{icon:S((()=>[L(m)])),default:S((()=>[Ct])),_:1},8,["loading"]),L(_,{key:"submit",type:"primary",onClick:a[1]||(a[1]=a=>e.handleOk(2)),loading:e.submiting},{icon:S((()=>[L(m)])),default:S((()=>[xt])),_:1},8,["loading"])])),default:S((()=>[L(u,{dataSource:e.formdata,rowKey:"r_id",pagination:!1,bordered:"",size:"small"},{default:S((()=>[L(d,{width:45,"data-index":"index",title:"序号",align:"center"},{default:S((({index:e})=>[O(M(e+1),1)])),_:1}),L(d,{"data-index":"b_all_path",width:146,title:"品牌",align:"center"},{default:S((({record:a,text:t})=>[O(M(e.getBrand(t))+" - "+M(a.b_name),1)])),_:1}),L(d,{"data-index":"r_fault_desc",width:176,title:"确认故障",align:"center"}),L(d,{"data-index":"r_replace_part",width:126,title:"更换配件",align:"center"}),L(d,{"data-index":"r_relate_product",title:"关联产品"},{default:S((({text:a})=>[D("ol",pt,[(x(!0),I(P,null,V(e.relateProductDeal(a),(a=>(x(),I("li",{key:a.p_id},[O(M(e.getBrand(a.b_all_path))+" - "+M(a.b_name||e.getModel(a.b_all_path.split("-")))+" - "+M(a.f_name)+" ",1),_t,O(M(a.num)+" ",1),1==a.isOut?(x(),I("span",mt,[L(r),ft])):2==a.isOut?(x(),I("small",ht,[L(o),vt])):3==a.isOut?(x(),I("small",gt,[L(s),bt])):(x(),I("small",kt,[L(c),wt]))])))),128))])])),_:1})])),_:1},8,["dataSource"])])),_:1},16,["visible"])}]]);const Dt=v({name:"LogisticsAdd",props:{visible:{type:Boolean,default:!1},selectedRows:{type:Array,default:()=>[]}},setup(e,{emit:l}){const n=g("context"),i=k(null),d=k(null),s=k({logistics_num:"",logistics_name:""}),c=function(){l("update:visible",!1)};return{modal:i,logisticsForm:d,formdata:s,handleCancel:c,handleOk:()=>o(this,null,(function*(){try{const s=yield d.value.validate();console.log(s),console.log(e.selectedRows),n.$http.post("repair/updateLogistics",(l=r({},s),o={ids:e.selectedRows.map((e=>e.r_id))},a(l,t(o)))).then((e=>{e.success?(n.$message.success(e.message),setTimeout(c,500)):n.$message.error(e.message)})).catch((e=>{console.log(e),n.$message.error(e)})).finally((()=>{i.value.submiting=!1}))}catch(s){i.value.submiting=!1}var l,o})),columns:[{title:"姓名",dataIndex:"c_name",width:106,align:"center"},{title:"型号",dataIndex:"b_name",width:96,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ie},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:de},{title:"发货",dataIndex:"r_is_deliver",width:62,align:"center",customRender:re},{title:"物流名称",dataIndex:"logistics_name",align:"center"},{title:"物流单号",dataIndex:"logistics_num",align:"center"}]}}});const Lt=v({name:"MaintainList",components:{FormModal:Oa,ClientRepairList:ct,DeliverModal:It,LogisticsAdd:m(Dt,[["render",function(e,a,t,l,n,i){const d=y("a-table"),r=y("a-divider"),o=y("a-input"),s=y("a-form-item"),c=y("a-form"),u=y("ZwModal");return x(),R(u,E({ref:"modal",visible:e.visible},e.$attrs,{onSubmit:e.handleOk}),{default:S((()=>[L(d,{dataSource:e.selectedRows,columns:e.columns,pagination:!1,size:"small"},null,8,["dataSource","columns"]),L(r),L(c,{ref:"logisticsForm",model:e.formdata,name:"logisticsForm","label-col":{span:5},"wrapper-col":{span:17}},{default:S((()=>[L(s,{label:"物流名称",name:"logistics_name",rules:[{required:!0,message:"Please input your 物流名称"}]},{default:S((()=>[L(o,{value:e.formdata.logistics_name,"onUpdate:value":a[0]||(a[0]=a=>e.formdata.logistics_name=a)},null,8,["value"])])),_:1}),L(s,{label:"物流号",name:"logistics_num",rules:[{required:!0,message:"Please input your 物流号"}]},{default:S((()=>[L(o,{value:e.formdata.logistics_num,"onUpdate:value":a[1]||(a[1]=a=>e.formdata.logistics_num=a)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},16,["visible","onSubmit"])}]])},props:{topTools:{type:Object,default:()=>({})},pageMode:{type:String,default:"total"}},setup(e){const a=g("context"),t=k(null),l=()=>{t.value.handleReload()},n=j({r_is_repair:null,r_repair_status:null,c_id:null,timeRange:null}),i=k(!1),d=k(!1),r=k(null),c=k(!1),p=k([]),_=e=>{c.value=!0,p.value=JSON.parse(e)};Q("onDMShow",_);const m=()=>o(this,null,(function*(){d.value&&(yield r.value.refresh()),l(),i.value=!1}));Q("reload",m);const f=j({mode:"add",record:{}}),v=Ya[`${e.pageMode}Columns`]({clientCellClick:e=>{f.record=e,d.value=!0},customCellClick:e=>{f.mode="editSingle",f.record=e,i.value=!0},colInputBlur(e){a.$http.put("repair/"+e.order,{order:e.order,list:[{r_id:e.id,[e.fields]:e.value}]}).then((e=>{a.$message.success(e.message),l()}))},reload(){l()}});Q("deliverSuccess",(function(){i.value=!1,d.value=!1,l()}));const b=k([]),w=k(!1);return{listdata:t,modalVisible:i,columns:v,ClientRepairList:r,crlVisible:d,formData:f,dmVisible:c,dmFormData:p,onDeliverModalVisible:_,beforeListdataLoad:a=>{"todo"===e.pageMode?a.deliver=2:"done"==e.pageMode&&(a.deliver=1),Object.keys(n).forEach((e=>{"timeRange"===e&&(!u(n[e])&&q(n[e])?(n[e][0]&&(n.start=s(n[e][0]).format("YYYY-MM-DD")+" 00:00:00"),n[e][1]&&(n.end=s(n[e][1]).format("YYYY-MM-DD")+" 23:59:59")):(delete n.start,delete n.end))})),Object.assign(a,n)},beforeFormOpen:(e,a,t)=>(f.mode=e,f.record=a,i.value=!0,!1),reload:m,clientListEditEvent:({record:e})=>{f.mode="editSingle",f.record=e,i.value=!0},appendSearch:n,handleReload:l,handleRowEdit:(e,a)=>{t.value.handleAction.edit(e,a)},handleRowDel:e=>{t.value.handleAction.del(e)},selectedRows:b,onListdataSelect:e=>{b.value=e},showAddLogisticsInfoDialog:()=>{w.value=!0},logisticsDialogVisible:w,staffData:h}}}),St=O("同意"),Ot=O("拒绝"),Mt=O("已维修"),Rt=O("维修中"),$t=O("原机返"),Pt=O(" 物流信息 ");var Vt=m(Lt,[["render",function(e,a,t,l,n,i){const d=y("a-select-option"),r=y("a-select"),o=y("a-range-picker"),s=y("a-button"),c=y("FormModal"),u=y("EditFilled"),p=y("a-tooltip"),_=y("DeleteTwoTone"),m=y("a-space"),f=y("ListData"),h=y("ClientRepairList"),v=y("DeliverModal"),g=y("LogisticsAdd"),b=y("ZwScrollbar");return x(),R(b,{"wrap-class":"pd-17"},{default:S((()=>[L(f,{ref:"listdata",rowKey:"r_id",columns:e.columns,apis:"repair","top-tools":e.topTools,"before-form-open":e.beforeFormOpen,"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataSelect:e.onListdataSelect},W({modal:S((()=>[L(c,{visible:e.modalVisible,"onUpdate:visible":a[4]||(a[4]=a=>e.modalVisible=a),"form-data":e.formData,width:1020,"mask-closable":!1,"z-index":1002,onListreload:e.reload},null,8,["visible","form-data","onListreload"])])),action:S((a=>[X(e.$slots,"action",ee(ae(a)),(()=>[L(m,{size:2},{default:S((()=>[L(p,{title:"编辑","mouseLeave-delay":0},{default:S((()=>[L(s,{type:"link",size:"small",onClick:G((t=>e.handleRowEdit(a.record,a.index)),["stop"])},{icon:S((()=>[L(u)])),_:2},1032,["onClick"])])),_:2},1024),L(p,{title:"删除","mouseLeave-delay":0},{default:S((()=>[L(s,{type:"link",size:"small",onClick:G((t=>e.handleRowDel(a.record)),["stop"])},{icon:S((()=>[L(_,{twoToneColor:"#ff4d4f"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)]),!0)])),_:2},["done"!==e.pageMode?{name:"append-search",fn:S((()=>[L(r,{value:e.appendSearch.r_is_repair,"onUpdate:value":a[0]||(a[0]=a=>e.appendSearch.r_is_repair=a),name:"r_is_repair",placeholder:"是否维修",allowClear:"",onChange:e.handleReload},{default:S((()=>[L(d,{value:1},{default:S((()=>[St])),_:1}),L(d,{value:2},{default:S((()=>[Ot])),_:1})])),_:1},8,["value","onChange"]),L(r,{value:e.appendSearch.r_repair_status,"onUpdate:value":a[1]||(a[1]=a=>e.appendSearch.r_repair_status=a),name:"r_repair_status",placeholder:"维修状态",allowClear:"",onChange:e.handleReload},{default:S((()=>[L(d,{value:1},{default:S((()=>[Mt])),_:1}),L(d,{value:2},{default:S((()=>[Rt])),_:1}),L(d,{value:3},{default:S((()=>[$t])),_:1})])),_:1},8,["value","onChange"]),"total"===e.pageMode?(x(),R(r,{key:0,value:e.appendSearch.c_id,"onUpdate:value":a[2]||(a[2]=a=>e.appendSearch.c_id=a),name:"c_id",placeholder:"客户姓名","show-search":"",allowClear:"","option-filter-prop":"title",onChange:e.handleReload},{default:S((()=>[(x(!0),I(P,null,V(e.staffData,(e=>(x(),R(d,{key:e.c_id,value:e.c_id,title:e.c_name},{default:S((()=>[O(M(e.c_name),1)])),_:2},1032,["value","title"])))),128))])),_:1},8,["value","onChange"])):U("",!0),"total"===e.pageMode?(x(),R(o,{key:1,name:"timeRange",value:e.appendSearch.timeRange,"onUpdate:value":a[3]||(a[3]=a=>e.appendSearch.timeRange=a)},null,8,["value"])):U("",!0),L(s,{disabled:e.selectedRows.length<=0,onClick:e.showAddLogisticsInfoDialog},{default:S((()=>[Pt])),_:1},8,["disabled","onClick"])]))}:void 0]),1032,["columns","top-tools","before-form-open","before-listdata-load","onListdataSelect"]),L(h,{ref:"ClientRepairList",visible:e.crlVisible,"onUpdate:visible":a[5]||(a[5]=a=>e.crlVisible=a),title:"客户维修机列表",formdata:e.formData.record||{},width:1280,"mask-closable":!1,onShowDeliverModal:e.onDeliverModalVisible,onShowFormModal:e.clientListEditEvent,"z-index":99},null,8,["visible","formdata","onShowDeliverModal","onShowFormModal"]),L(v,{visible:e.dmVisible,"onUpdate:visible":a[6]||(a[6]=a=>e.dmVisible=a),title:"发货机列表",formdata:e.dmFormData,"onUpdate:formdata":a[7]||(a[7]=a=>e.dmFormData=a),width:930,"mask-closable":!1,"z-index":1003},null,8,["visible","formdata"]),L(g,{visible:e.logisticsDialogVisible,"onUpdate:visible":a[8]||(a[8]=a=>e.logisticsDialogVisible=a),title:"批量添加物流信息",width:930,"selected-rows":e.selectedRows},null,8,["visible","selected-rows"])])),_:3})}],["__scopeId","data-v-9c645ed2"]]);export{Vt as M};
