var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,d=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a,t)=>new Promise(((l,n)=>{var i=e=>{try{r(t.next(e))}catch(a){n(a)}},d=e=>{try{r(t.throw(e))}catch(a){n(a)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,d);r((t=t.apply(e,a)).next())}));import"./vue.f15e169e.js";import{d as o}from"./dayjs.39b8ebe2.js";import{l as s}from"./lodash.3cabe671.js";import{i as c,c as u,f as p,_,h as m,s as h}from"./index.8b362930.js";import{d as f,k as v,l as g,v as b,U as k,_ as w,A as y,$ as C,a2 as x,a3 as I,m as D,a1 as L,J as S,ab as O,a0 as M,z as R,F as $,a7 as P,ae as V,a9 as U,aa as z,W as B,f as E,y as j,w as A,M as F,K as T,h as N,X as Y,s as q,B as J,n as K,i as Z,p as H,aj as Q,S as W,H as X,a4 as G,ak as ee}from"./@vue.454ad140.js";import{Q as ae,P as te}from"./@ant-design.0ba83ffb.js";import{O as le,i as ne,r as ie,d as de}from"./index.37fd2edc.js";const re=f({name:"MachineItem",emits:["update:itemValue","itemDel","itemBrandValueChange","itemShowProductList","itemChecked"],props:{itemValue:{type:Object,default:()=>({})}},components:{},setup(e,{emit:a,attrs:t}){const l=v("context"),n=g({get:()=>e.itemValue,set(e){a("update:itemValue",e)}}),i=g((()=>Number(t.index)+1)),d=e=>{const a=e?Number(e.split("-")[1]):null;return m(u.value,a)},r=e=>{if(0===e.length)return"";const a=e[e.length-1];return m(u.value,a)},o=g((()=>{const e=n.value;return`\n                机器型号：${d(e.b_all_path)+" - "+r(e.brandValue)||"-"} ;\r\n\n                机身编号：${e.machine_id||"-"} ;\r\n\n                原有故障：${e.r_o_fault||"-"} ;\r\n\n                确认故障：${e.r_fault_desc||"-"} ;\r\n\n                更换配件：${e.r_replace_part||"-"} ;\r\n\n                价格：${e.r_price||"-"} 。\n            `})),s=v("onDMShow"),_=v("deliverSuccess"),h=b(!1),f=g((()=>{const e=l.$store.state.machine.engineers;return e&&e.length>0&&(n.value.u_id||e.forEach((e=>{if(e.default)return n.value.u_id=e.id}))),e}));return c(f.value)&&l.$store.dispatch("machine/get_engineers"),{brandData:u,item:n,index:i,handleDelItem:()=>{a("itemDel",t.index)},fixProblem:p,handleBrandChange:(e,l)=>{const n={b_all_path:"",b_id:null,b_name:""};c(e)||(n.b_all_path=e.join("-"),n.b_id=e[e.length-1],n.b_name=l[e.length-1].b_name),a("itemBrandValueChange",{options:n,index:t.index})},handleSearchPart:e=>{a("itemShowProductList",{index:t.index})},cascaderFilter:(e,a)=>a.some((a=>a.b_name.toLowerCase().indexOf(e.toLowerCase())>-1)),getBrand:d,getModel:r,handleDelPro:e=>{n.value.r_relate_product.splice(e,1)},handleSelectorChange:(e,a)=>{e&&void 0!==e||(n.value[a]=null)},copyData:o,handleDeliver:()=>{s(JSON.stringify([n.value]))},handleCandelDeliver:()=>{l.$modal.confirm({title:"提示",content:"确定要取消发货么？",icon:k(ae),okText:"确定",okType:"danger",zIndex:1005,onOk:()=>new Promise(((e,a)=>{l.$http.post("repair/cancel_deliver/"+n.value.r_id).then((t=>{t.success?(l.$message.success(t.message),_(),e(t)):a()})).catch((e=>{a(e)}))}))})},handleCheckboxChange:function(e){a("itemChecked",{index:i.value,checked:e.target.checked})},checked:h,engineers:f}}}),oe=e=>(U("data-v-5b213d1c"),e=e(),z(),e),se={class:"form-table",id:"form-table",cellspacing:"0",cellpadding:"0"},ce={class:"tdw100",colspan:"6"},ue={class:"tools__l"},pe={class:"a-table__row"},_e=oe((()=>I("td",{class:"tdl tdl3_w"},[I("i",{class:"required"}," * "),S(" 机器型号")],-1))),me={class:"tdc tdc3_w"},he=oe((()=>I("td",{class:"tdl tdl3_w"}," 机器编号 ",-1))),fe={class:"tdc tdc3_w"},ve=oe((()=>I("td",{class:"tdl tdl3_w"}," 价格（￥） ",-1))),ge={class:"tdc tdc3_w"},be={class:"a-table__row"},ke=oe((()=>I("td",{class:"tdl tdl3_w"},"是否同意",-1))),we={class:"tdc tdc3_w"},ye=S("同意维修"),Ce=S("拒绝维修"),xe=oe((()=>I("td",{class:"tdl tdl3_w"}," 维修状态 ",-1))),Ie={class:"tdc tdc3_w"},De=S("已维修"),Le=S("维修中"),Se=S("原机返"),Oe=oe((()=>I("td",{class:"tdl tdl3_w"}," 维修人 ",-1))),Me={class:"tdc tdc3_w"},Re={class:"a-table__row"},$e=oe((()=>I("td",{class:"tdl tdl3_w"},"物流名称",-1))),Pe={class:"tdc tdc2_w",colspan:"2"},Ve=oe((()=>I("td",{class:"tdl tdl3_w"}," 物流号 ",-1))),Ue={class:"tdc tdc2_w",colspan:"2"},ze={class:"a-table__row"},Be=oe((()=>I("td",{class:"tdl tdl3_w"},"随机附件",-1))),Ee={class:"tdc tdcol5_w",colspan:"5"},je={class:"a-table__row"},Ae=oe((()=>I("td",{class:"tdl tdl3_w"},[I("i",{class:"required"}," * "),S("原有故障")],-1))),Fe={class:"tdc tdcol5_w",colspan:"5"},Te={class:"a-table__row"},Ne=oe((()=>I("td",{class:"tdl tdl3_w"},"确认故障",-1))),Ye={class:"tdc tdcol5_w",colspan:"5"},qe={class:"a-table__row"},Je=oe((()=>I("td",{class:"tdl tdl3_w"},"更换配件",-1))),Ke={class:"tdc tdcol5_w",colspan:"5"},Ze={class:"pro-selector"},He={class:"pro-selected-li"},Qe=oe((()=>I("small",null,"       x",-1))),We={key:0,class:"isout",style:{color:"green"}},Xe=oe((()=>I("span",null,"已出库",-1))),Ge={key:1,class:"isout",style:{color:"orange"}},ea=oe((()=>I("span",null,"出库失败",-1))),aa={key:2,class:"isout",style:{color:"gray"}},ta=oe((()=>I("span",null," 待出库 ",-1))),la={key:3,class:"split-btn"},na=["onClick"],ia={class:"a-table__row"},da=oe((()=>I("td",{class:"tdl tdl3_w"},"备注",-1))),ra={class:"tdc tdcol5_w",colspan:"5"};var oa=_(re,[["render",function(e,a,t,l,n,i){const d=w("a-checkbox"),r=w("a-col"),o=w("ZwIcons"),s=w("a-button"),c=w("a-tooltip"),u=w("CopyTwoTone"),p=w("DeleteTwoTone"),_=w("a-space"),m=w("a-row"),h=w("a-cascader"),f=w("a-input"),v=w("a-select-option"),g=w("a-select"),b=w("a-textarea"),k=w("UnorderedListOutlined"),U=w("a-input-search"),z=w("a-divider"),B=w("CheckCircleOutlined"),E=w("ExclamationCircleOutlined"),j=w("ClockCircleOutlined"),A=w("CloseCircleOutlined"),F=y("clipboard");return C(),x("table",se,[I("tr",null,[I("td",ce,[D(m,{class:"tools"},{default:L((()=>[D(r,{span:12},{default:L((()=>[I("div",ue,[D(d,{checked:e.checked,"onUpdate:checked":a[0]||(a[0]=a=>e.checked=a),onChange:e.handleCheckboxChange},{default:L((()=>[S(O(e.index)+" -- "+O(e.item.r_id),1)])),_:1},8,["checked","onChange"])])])),_:1}),D(r,{span:12},{default:L((()=>[D(_,{class:"tools__r",size:0},{default:L((()=>[1==e.item.r_is_deliver?(C(),M(c,{key:0,title:"取消发货"},{default:L((()=>[D(s,{type:"link",class:"candel-deliver",onClick:e.handleCandelDeliver},{default:L((()=>[D(o,{name:"fahuo",type:"svg"})])),_:1},8,["onClick"])])),_:1})):(C(),M(c,{key:1,title:"去发货"},{default:L((()=>[D(s,{type:"link",onClick:e.handleDeliver},{default:L((()=>[D(o,{name:"fahuo",type:"svg"})])),_:1},8,["onClick"])])),_:1})),D(c,{title:"复制数据"},{default:L((()=>[R((C(),M(s,{type:"link"},{default:L((()=>[D(u)])),_:1})),[[F,e.copyData]])])),_:1}),D(c,{title:"删除此项"},{default:L((()=>[D(s,{type:"link",onClick:e.handleDelItem},{default:L((()=>[D(p,{twoToneColor:"#ff4d4f"})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])]),I("tr",pe,[_e,I("td",me,[D(h,{value:e.item.brandValue,"onUpdate:value":a[1]||(a[1]=a=>e.item.brandValue=a),options:e.brandData,"field-names":{label:"b_name",value:"b_id"},"get-popup-container":e.fixProblem,"expand-trigger":"hover","change-on-select":"","show-search":{filter:e.cascaderFilter},placeholder:"选择品牌型号",onChange:e.handleBrandChange},null,8,["value","options","get-popup-container","show-search","onChange"])]),he,I("td",fe,[D(f,{type:"text",value:e.item.machine_id,"onUpdate:value":a[2]||(a[2]=a=>e.item.machine_id=a),placeholder:"机器编号"},null,8,["value"])]),ve,I("td",ge,[D(f,{type:"text",value:e.item.r_price,"onUpdate:value":a[3]||(a[3]=a=>e.item.r_price=a),name:"r_price"},null,8,["value"])])]),I("tr",be,[ke,I("td",we,[D(g,{value:e.item.r_is_repair,"onUpdate:value":a[4]||(a[4]=a=>e.item.r_is_repair=a),name:"r_is_repair",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem,onChange:a[5]||(a[5]=a=>e.handleSelectorChange(a,"r_is_repair"))},{default:L((()=>[D(v,{value:1},{default:L((()=>[ye])),_:1}),D(v,{value:2},{default:L((()=>[Ce])),_:1})])),_:1},8,["value","get-popup-container"])]),xe,I("td",Ie,[D(g,{value:e.item.r_repair_status,"onUpdate:value":a[6]||(a[6]=a=>e.item.r_repair_status=a),name:"r_repair_status",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem,onChange:a[7]||(a[7]=a=>e.handleSelectorChange(a,"r_repair_status"))},{default:L((()=>[D(v,{value:1},{default:L((()=>[De])),_:1}),D(v,{value:2},{default:L((()=>[Le])),_:1}),D(v,{value:3},{default:L((()=>[Se])),_:1})])),_:1},8,["value","get-popup-container"])]),Oe,I("td",Me,[D(g,{value:e.item.u_id,"onUpdate:value":a[8]||(a[8]=a=>e.item.u_id=a),name:"u_id",placeholder:"请选择",allowClear:"","get-popup-container":e.fixProblem},{default:L((()=>[(C(!0),x($,null,P(e.engineers,(e=>(C(),M(v,{key:e.id,value:e.id},{default:L((()=>[S(O(e.realname||e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","get-popup-container"])])]),I("tr",Re,[$e,I("td",Pe,[D(f,{type:"text",value:e.item.logistics_name,"onUpdate:value":a[9]||(a[9]=a=>e.item.logistics_name=a),name:"logistics_name",placeholder:"物流名称"},null,8,["value"])]),Ve,I("td",Ue,[D(f,{type:"text",placeholder:"物流单号",value:e.item.logistics_num,"onUpdate:value":a[10]||(a[10]=a=>e.item.logistics_num=a),name:"logistics_num"},null,8,["value"])])]),I("tr",ze,[Be,I("td",Ee,[D(f,{type:"text",value:e.item.affix,"onUpdate:value":a[11]||(a[11]=a=>e.item.affix=a),name:"affix",placeholder:"随机附带的配件"},null,8,["value"])])]),I("tr",je,[Ae,I("td",Fe,[D(b,{value:e.item.r_o_fault,"onUpdate:value":a[12]||(a[12]=a=>e.item.r_o_fault=a),name:"r_o_fault",placeholder:"输入机器原始故障","auto-size":{minRows:2}},null,8,["value"])])]),I("tr",Te,[Ne,I("td",Ye,[D(b,{value:e.item.r_fault_desc,"onUpdate:value":a[13]||(a[13]=a=>e.item.r_fault_desc=a),name:"r_fault_desc",placeholder:"确认机器故障","auto-size":{minRows:2}},null,8,["value"])])]),I("tr",qe,[Je,I("td",Ke,[I("div",Ze,[D(U,{value:e.item.r_replace_part,"onUpdate:value":a[14]||(a[14]=a=>e.item.r_replace_part=a),placeholder:"更换配件说明, 点击右侧按钮选择关联配件",onSearch:e.handleSearchPart},{enterButton:L((()=>[D(s,{style:{"background-color":"#f2f2f2"}},{default:L((()=>[D(k)])),_:1})])),_:1},8,["value","onSearch"]),D(z),I("ol",He,[(C(!0),x($,null,P(e.item.r_relate_product,((a,t)=>(C(),x("li",{key:a.p_id},[S(O(t+1)+". "+O(e.getBrand(a.b_all_path))+" - "+O(a.b_name||e.getModel(a.b_all_path.split("-")))+" - "+O(a.f_name)+" ",1),Qe,S(" "+O(a.num)+" ",1),2==a.isOut?(C(),x("span",We,[D(B),Xe])):3==a.isOut?(C(),x("span",Ge,[D(E),ea])):(C(),x("span",aa,[D(j),ta])),2===e.item.r_is_deliver?(C(),x("span",la,[I("span",{style:{color:"red",cursor:"pointer"},onClick:a=>e.handleDelPro(t)},[D(A)],8,na)])):V("",!0)])))),128))])])])]),I("tr",ia,[da,I("td",ra,[D(b,{value:e.item.r_mark,"onUpdate:value":a[15]||(a[15]=a=>e.item.r_mark=a)},null,8,["value"])])])])}],["__scopeId","data-v-5b213d1c"]]);const sa=f({name:"ListModal",emits:["update:visible","ensure"],components:{},props:{visible:{type:Boolean,default:!1},keywords:{type:String,default:""},zIndexModel:{type:Number,default:1e3}},setup(e,{emit:a}){const t=b(null),l=function(){a("update:visible",!1)};return{listdata:t,columns:[{title:"品牌",dataIndex:["b","b_all_path"],width:118,align:"center",customRender:({text:e})=>{const a=e?Number(e.split("-")[1]):null;return m(u.value,a)}},{title:"型号",dataIndex:["b","b_name"],width:118,align:"center"},{title:"配件名称",dataIndex:["f","f_name"],align:"center",width:152},{title:"总数",dataIndex:"p_total_num",align:"center",width:72},{title:"状态",dataIndex:"p_state",width:72,align:"center",customRender:({text:e})=>k(w("a-tag"),{color:1===e?"blue":"orange"},{default:()=>1===e?"正常":"处理"})},{title:"操作",dataIndex:"selection",width:108,align:"center"}],handleCancel:l,handleOk:function(){const e=t.value.getSelectedRows();a("ensure",e),l()}}}}),ca=S("取消 "),ua=S("确定 ");var pa=f({name:"FormModal",components:{PlusOutlined:te,MItem:oa,ListModal:_(sa,[["render",function(e,a,t,l,n,i){const d=w("ListData"),r=w("CloseOutlined"),o=w("a-button"),s=w("CheckOutlined"),c=w("zwModal");return C(),M(c,B({visible:e.visible,closable:!1},e.$attrs),{footer:L((()=>[D(o,{key:"back",onClick:e.handleCancel},{icon:L((()=>[D(r)])),default:L((()=>[ca])),_:1},8,["onClick"]),D(o,{key:"submit",type:"primary",onClick:e.handleOk},{icon:L((()=>[D(s)])),default:L((()=>[ua])),_:1},8,["onClick"])])),default:L((()=>[D(d,{ref:"listdata",keywords:e.keywords,columns:e.columns,rowKey:"p_id",apis:{query:"product",add:"product"},"dynamic-form":"ProductForm","z-index":e.zIndexModel+1,"can-select":!0},null,8,["keywords","columns","z-index"])])),_:1},16,["visible"])}]])},props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})}},setup(e,{emit:a}){const t=v("context"),l=b(!1),n=b(!1),i=b(!1),d="YYYY-MM-DD HH:mm:ss",u=E({order:"",c_id:null,c_name:"",receipt_date:o(),mark:"",sum_price:0,delDatas:null,list:[s.exports.cloneDeep(le)]}),_=b([]);const m=E({checkedIndexs:[],indeterminate:!1,checkedAll:!1}),f=({index:e,checked:a})=>{const t=m.checkedIndexs,l=t.includes(e);a?!l&&t.push(e):l&&t.splice(t.findIndex((a=>a===e),1))},w=b(!0);function y(e,a){return r(this,null,(function*(){if("add"!==a&&e){let r,s;l.value=!0,"editSingle"===a?(r=yield(i=e.r_id,new Promise(((e,a)=>{t.$http.get("repair/"+i).then((t=>{t.success?e(t.data):a(t.message)})).catch((e=>{a(e)}))}))),s=[r]):(r=yield(n=e.r_order,new Promise(((e,a)=>{t.$http.get("repair_order/"+n).then((t=>{t.success?e(t.data):a(t.message)})).catch((e=>{a(e)}))}))),s=r.rs),l.value=!1,r.rs&&Y(r.rs)?(u.order=r.order,u.c_id=r.c_id,u.c_name=r.c_name,u.receipt_date=o(r.receipt_date,d),u.mark=r.mark||""):(u.order=r.ro.order,u.c_id=r.ro.c_id,u.c_name=r.ro.c_name,u.receipt_date=o(r.ro.receipt_date,d),u.mark=r.ro.mark||""),u.list=s.map((e=>{const a=e.brand.b_all_path;return e.b_all_path=a,e.b_id=e.brand.b_id,e.b_name=e.brand.b_name,a&&(e.brandValue=a.split("-").map((e=>Number(e)))),e}))}else u.receipt_date=o(),u.list=[s.exports.cloneDeep(le)];var n,i}))}j((()=>{e.visible&&y(e.formData.record,e.formData.mode)}));const C=s.exports.throttle((()=>{u.list.push(s.exports.cloneDeep(le))}),200),x=s.exports.throttle((e=>{if(u.list.length<=1)return t.$message.warn("已经是最后一条数据了");t.$modal.confirm({title:"删除提示",content:k("div",{},`此操作将删除第 ${e+1} 条数据，是否继续？`),icon:k(ae),okText:"确定",okType:"danger",zIndex:1005,onOk(){const a=u.list.splice(e,1);a[0].r_id&&(u.delDatas||(u.delDatas=[]),u.delDatas.push(a[0].r_id))}})}),500);A((()=>m.checkedIndexs),(e=>{m.indeterminate=!!e.length&&e.length<u.list.length,m.checkedAll=e.length===u.list.length}),{deep:!0});const{indeterminate:I,checkedAll:D}=F(m),L=v("onDMShow"),S=b("");T((()=>{_.value=[]}));const O=b(null),M=g((()=>null!==O.value&&O.value>=0?u.list[O.value].b_name:""));function R(){return n.value=!0,new Promise(((a,l)=>{if(!function(){if(!u.c_id)return t.$message.warning("请选择客户"),!1;if(!u.list||u.list.length<=0)return t.$message.warning("维修列表不能为空"),!1;let e=0;return u.list.forEach(((a,l)=>{const n=a.r_relate_product;c(n)&&(a.r_relate_product=""),a.brandValue.length&&a.r_o_fault||(e++,t.$message.warning({content:k("span",{style:"color: #E6A23C; margin-left: 20px"},[k("b",{style:"color: #f00"},"* "),k("small",null,"为必填项, 请完善第 "),k("b",{style:"color: #f00"},l+1),k("small",null," 条数据")]),duration:2+.5*l,icon:k(ae)}))})),o.isDayjs(u.receipt_date)&&(u.receipt_date=u.receipt_date&&u.receipt_date.format(d)),0===e}())return n.value=!1,l();const i=e.formData.mode;let r="repair";"edit"!==i&&"editSingle"!==i||(r="repair/"+u.order),t.$http({url:r,method:"add"===i?"POST":"PUT",data:u}).then((e=>{e.success?a(e):(t.$message.error(e.message),l(e.message))})).catch((e=>{l(e)}))}))}N((()=>{C.cancel(),x.cancel()}));return{dateFormat:d,loadingList:l,confirmLoading:n,showListModal:i,mIndex:O,keywords:M,foo:u,handleAdd:C,handleModalOk:()=>{R().then((e=>{t.$message.success(e.message),a("listreload")})).finally((()=>{n.value=!1}))},modalClosed:()=>{u.order=null,u.c_id=null,u.c_name="",u.mark="",u.delDatas=null,u.receipt_date=null,u.sum_price=0,u.list=[s.exports.cloneDeep(le)],m.indeterminate=!1,_.value.forEach((e=>{e.checked=!1,f({index:e.index,checked:!1})}))},handleDelItem:x,staffData:h,fixProblem:p,staffSelect:(e,a)=>{u.c_name=a.title},handleBrandValueChange:({options:e,index:a})=>{Object.assign(u.list[a],e)},handleShowProductList:({index:e})=>{O.value=e,i.value=!0},handleProductSelected:e=>{const a=[...u.list[O.value].r_relate_product],t=[...a];e.forEach((e=>{a.some((a=>a.p_id===e.p_id))||t.push({p_id:e.p_id,f_id:e.f_id,b_all_path:e.b.b_all_path,f_name:e.f.f_name,repair_price:e.repair_price,b_name:e.b.b_name,num:1,isOut:0})})),u.list[O.value].r_relate_product=c(t)?"":t},onItemChecked:f,checkedAll:D,indeterminate:I,handleAllChecked:function(e){m.indeterminate=!1;const a=e.target.checked;_.value.forEach((e=>{e.checked=a,f({index:e.index,checked:a})}))},mItems:_,handleDeliver:function(){if(c(m.checkedIndexs))return t.$message.warn("请选择需要发货的机器");L(JSON.stringify(m.checkedIndexs.map((e=>u.list[e-1]))))},copydata:S,handleCopyList:function(e){if(e.preventDefault||e.cancelBubble,S.value="",c(m.checkedIndexs))return t.$message.warn("请选择需要复制的机器信息");_.value.forEach(((e,a)=>{e.checked&&(S.value+=e.copyData+"\r\n\r\n")}))},canEdit:w}}});const _a=e=>(U("data-v-f1c1ea02"),e=e(),z(),e),ma={class:"form-table",cellspacing:"0",cellpadding:"0"},ha=_a((()=>I("td",{class:"tdl tdl2_w"},[I("i",{class:"required"}," * "),S(" 客户")],-1))),fa={class:"tdc tdc2_w"},va=_a((()=>I("td",{class:"tdl tdl2_w"}," 收货时间 ",-1))),ga={class:"tdc tdc2_w"},ba=_a((()=>I("td",{class:"tdl tdl_w"},"备注",-1))),ka={class:"tdc tdc_w",colspan:"3"},wa=S(" 维修机清单： 共 "),ya=S(" 台 "),Ca=S(" 全选 "),xa={class:"tools-bar-btns"},Ia=S("发货"),Da=S("复制信息"),La=S(" 添 加 机 器 ");var Sa=_(pa,[["render",function(e,a,t,l,n,i){const d=w("a-select-option"),r=w("a-select"),o=w("a-form-item"),s=w("a-date-picker");w("a-input");const c=w("a-textarea"),u=w("a-divider"),p=w("a-checkbox"),_=w("a-col"),m=w("a-button"),h=w("a-row"),f=w("MItem"),v=w("a-spin"),g=w("PlusOutlined"),b=w("a-form"),k=w("a-modal"),U=w("ListModal"),z=y("can-edit"),E=y("clipboard");return C(),x($,null,[D(k,B({visible:e.visible,title:"维修机"},e.$attrs,{"confirm-loading":e.confirmLoading,"z-index":100,"after-close":e.modalClosed,onOk:e.handleModalOk}),{default:L((()=>[D(b,{ref:"MachineForm",model:e.foo,class:"machine-form","label-col":{span:0},"wrapper-col":{span:24}},{default:L((()=>[I("table",ma,[I("tr",null,[ha,I("td",fa,[D(o,{name:"c_id"},{default:L((()=>[R((C(),M(r,{value:e.foo.c_id,"onUpdate:value":a[0]||(a[0]=a=>e.foo.c_id=a),placeholder:"请选择","show-search":"",allowClear:"","option-filter-prop":"title","get-popup-container":e.fixProblem,onSelect:e.staffSelect},{default:L((()=>[(C(!0),x($,null,P(e.staffData,(e=>(C(),M(d,{key:e.c_id,value:e.c_id,title:e.c_name},{default:L((()=>[S(O(e.c_name),1)])),_:2},1032,["value","title"])))),128))])),_:1},8,["value","get-popup-container","onSelect"])),[[z,e.canEdit]])])),_:1})]),va,I("td",ga,[D(s,{value:e.foo.receipt_date,"onUpdate:value":a[1]||(a[1]=a=>e.foo.receipt_date=a),"show-Time":"","allow-clear":"","value-format":e.dateFormat,format:e.dateFormat,getPopupContainer:e.fixProblem},null,8,["value","value-format","format","getPopupContainer"])])]),V("",!0),I("tr",null,[ba,I("td",ka,[D(o,{name:"mark"},{default:L((()=>[D(c,{value:e.foo.mark,"onUpdate:value":a[2]||(a[2]=a=>e.foo.mark=a),placeholder:"备注信息"},null,8,["value"])])),_:1})])])]),D(u,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:L((()=>[I("span",null,[wa,I("strong",null,O(e.foo.list.length),1),ya])])),_:1}),e.foo.list.length>1?(C(),M(h,{key:0,class:"tools-bar"},{default:L((()=>[D(_,{class:"tools-bar-left",span:10},{default:L((()=>[D(p,{checked:e.checkedAll,"onUpdate:checked":a[3]||(a[3]=a=>e.checkedAll=a),indeterminate:e.indeterminate,onChange:e.handleAllChecked},{default:L((()=>[Ca])),_:1},8,["checked","indeterminate","onChange"])])),_:1}),D(_,{span:14},{default:L((()=>[I("div",xa,[D(m,{onClick:e.handleDeliver},{default:L((()=>[Ia])),_:1},8,["onClick"]),R((C(),M(m,{onClick:e.handleCopyList},{default:L((()=>[Da])),_:1},8,["onClick"])),[[E,e.copydata]])])])),_:1})])),_:1})):V("",!0),D(v,{spinning:e.loadingList},{default:L((()=>[D(q,{name:"slide-fade",tag:"div"},{default:L((()=>[(C(!0),x($,null,P(e.foo.list,((a,t)=>(C(),M(f,{key:t,ref_for:!0,ref:a=>{a&&(e.mItems[t]=a)},itemValue:e.foo.list[t],"onUpdate:itemValue":a=>e.foo.list[t]=a,index:t,onItemDel:e.handleDelItem,onItemBrandValueChange:e.handleBrandValueChange,onItemShowProductList:e.handleShowProductList,onItemChecked:e.onItemChecked},null,8,["itemValue","onUpdate:itemValue","index","onItemDel","onItemBrandValueChange","onItemShowProductList","onItemChecked"])))),128))])),_:1})])),_:1},8,["spinning"]),"add"===e.formData.mode||"edit"===e.formData.mode?(C(),M(m,{key:1,block:"",onClick:e.handleAdd},{default:L((()=>[D(g),La])),_:1},8,["onClick"])):V("",!0)])),_:1},8,["model"])])),_:1},16,["visible","confirm-loading","after-close","onOk"]),D(U,{visible:e.showListModal,"onUpdate:visible":a[4]||(a[4]=a=>e.showListModal=a),width:860,title:"产品列表选择","z-index-model":1101,"mask-closable":!1,keywords:e.keywords,onEnsure:e.handleProductSelected},null,8,["visible","keywords","onEnsure"])],64)}],["__scopeId","data-v-f1c1ea02"]]);var Oa=_(f({name:"ColsInput",props:["fields","order","fieldsValue","placeholder","id"],setup(e,{emit:a}){const t=b("");A((()=>e.fieldsValue),(e=>{t.value=e}),{immediate:!0});const l=b(!0),n=b(null);return J((()=>{})),{val:t,aInput:n,handleModify:()=>{l.value=!0,a("colsInputBlur",{id:e.id,value:t.value,fields:e.fields,order:e.order})},isReadonly:l,handleEdit:()=>{l.value=!1,K((()=>{n.value.focus()}))}}}}),[["render",function(e,a,t,l,n,i){const d=w("EditOutlined"),r=w("a-input");return C(),M(r,{ref:"aInput",value:e.val,"onUpdate:value":a[1]||(a[1]=a=>e.val=a),disabled:e.isReadonly,placeholder:e.placeholder,size:"small",onBlur:e.handleModify,tabindex:e.id},{suffix:L((()=>[D(d,{onClick:a[0]||(a[0]=a=>e.handleEdit()),style:{color:"rgba(0, 0, 0, 0.65)",cursor:"pointer"}})])),_:1},8,["value","disabled","placeholder","onBlur","tabindex"])}],["__scopeId","data-v-23e1ce4e"]]);const Ma=f({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:a}){const t=v("context");return{val:g({get:()=>e.fieldsValue,set(e){a("update:fieldsValue",e)}}),handleChage:l=>{t.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:l}]}).then((e=>{t.$message.success(e.message),a("reload")}))}}}}),Ra=S(" 同意 "),$a=S(" 拒绝 ");var Pa=_(Ma,[["render",function(e,a,t,l,n,i){const d=w("a-select-option"),r=w("a-select");return C(),M(r,{value:e.val,"onUpdate:value":a[0]||(a[0]=a=>e.val=a),placeholder:"请选择",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:L((()=>[D(d,{value:1},{default:L((()=>[Ra])),_:1}),D(d,{value:2},{default:L((()=>[$a])),_:1})])),_:1},8,["value","onChange"])}]]);const Va=f({name:"ColsSelector",props:["fieldsValue","dataId","fields","order"],setup(e,{emit:a}){const t=v("context");return{val:g({get:()=>e.fieldsValue,set(e){a("update:fields-value",e)}}),handleChage:l=>{t.$http.put("repair/"+e.dataId,{order:e.order,list:[{r_id:e.dataId,[e.fields]:l}]}).then((e=>{t.$message.success(e.message),a("reload")}))}}}}),Ua=S(" 已维修 "),za=S(" 维修中 "),Ba=S(" 原机返 ");var Ea=_(Va,[["render",function(e,a,t,l,n,i){const d=w("a-select-option"),r=w("a-select");return C(),M(r,{value:e.val,"onUpdate:value":a[0]||(a[0]=a=>e.val=a),placeholder:"请选择",onChange:e.handleChage,style:{width:"100%"},size:"small"},{default:L((()=>[D(d,{value:1},{default:L((()=>[Ua])),_:1}),D(d,{value:2},{default:L((()=>[za])),_:1}),D(d,{value:3},{default:L((()=>[Ba])),_:1})])),_:1},8,["value","onChange"])}]]);function ja({text:e}){return e?e.substring(2,11):"--"}const Aa=e=>[{title:"收货日期",dataIndex:"receipt_date",width:72,align:"center",customRender:ja},{title:"姓名",dataIndex:"c_name",width:86,align:"center",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.clientCellClick(a,t,l)}})},{title:"型号",dataIndex:"b_name",width:86,align:"center"},{title:"原故障",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"确认故障",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})},{title:"更换配件",dataIndex:"r_replace_part",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})}],Fa=e=>[{title:"型号",dataIndex:"b_name",width:86,align:"center"},{title:"原故障",dataIndex:"r_o_fault",ellipsis:!0,width:118},{title:"确认故障",ellipsis:!0,dataIndex:"r_fault_desc",customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})},{title:"更换配件",dataIndex:"r_replace_part",ellipsis:!0,customCell:(a,t)=>({class:"ant-table-row-cell-ellipsis ant-table-row-cell-break-word click-cursor",onClick:l=>{l.stopPropagation(),e.customCellClick(a,t,l)}})}],Ta=e=>[{title:"价格(￥)",dataIndex:"r_price",width:86,customRender:({record:a,text:t})=>k(Oa,{fields:"r_price",fieldsValue:t,id:a.r_id,placeholder:"维修价格",order:a.r_order,onColsInputBlur:e.colInputBlur})},{title:"是否维修",dataIndex:"r_is_repair",width:96,align:"center",customRender:({record:a,text:t})=>k(Pa,{fields:"r_is_repair",fieldsValue:t,order:a.r_order,"data-id":a.r_id,onReload:e.reload})},{title:"维修状态",dataIndex:"r_repair_status",width:96,align:"center",customRender:({record:a,text:t})=>k(Ea,{fields:"r_repair_status",fieldsValue:t,order:a.r_order,"data-id":a.r_id,onReload:e.reload})},{title:"机器编号",dataIndex:"machine_id",width:132,customRender:({record:a,text:t})=>k(Oa,{class:"ipt-font-bold",fields:"machine_id",fieldsValue:t,id:a.r_id,order:a.r_order,placeholder:"机器编号",onColsInputBlur:e.colInputBlur})}];var Na={totalColumns:e=>[...Aa(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ne},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:ie},{title:"发货",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:de},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"操作",dataIndex:"action",width:72,align:"center"}],todoColumns:e=>[...Aa(e),...Ta(e),{title:"操作",dataIndex:"action",width:72,align:"center"}],doneColumns:e=>[{title:"发货日期",dataIndex:"r_delivery_date",key:"r_delivery_date",width:72,align:"center",customRender:ja},...Aa(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ne},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:ie},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0},{title:"操作",dataIndex:"action",width:72,align:"center"}]};const Ya=f({name:"ClientRepairList",components:{},props:{visible:{type:Boolean,default:!1},formdata:{type:Object,default:()=>({})}},setup(e,{emit:a}){const t=v("context"),l=v("reload"),n=g((()=>{const e=t.$route.path;return e.includes("todo")?2:e.includes("done")?1:0})),i=b(0),d=(e,t,l)=>{a("showFormModal",{record:e,index:t,e:l})},o=2===n.value?[...Fa(s={customCellClick:d,colInputBlur(e){t.$http.put("repair/"+e.order,{order:e.order,list:[{r_id:e.id,[e.fields]:e.value}]}).then((e=>{t.$message.success(e.message),l()}))},reload:l}),...Ta(s)]:(e=>[...Fa(e),{title:"价格(￥)",dataIndex:"r_price",key:"r_price",width:86,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ne},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:ie},{title:"发货",key:"r_is_deliver",dataIndex:"r_is_deliver",width:52,align:"center",customRender:de},{title:"机器编号",key:"machine_id",dataIndex:"machine_id",width:132,align:"center",ellipsis:!0}])({customCellClick:d,reload:l});var s;const u=b(null),p=b(0),_=b("");return A((()=>e.visible),(e=>{e||(i.value=0)})),{isDeliverRef:n,columns:o,ListDataRefs:u,refresh:()=>r(this,null,(function*(){yield u.value.handleReload()})),sumPriceRef:i,beforeListdataLoad:a=>{a.c_id=e.formdata["ro.c_id"],a.deliver=n.value||null},count:p,onListdataLoaded:e=>{p.value=e.data.count},handleToolsbarAction:function(e,l){const n=u.value.getSelectedRows();if(c(n))return l.stopPropagation||l.cancelBubble,t.$message.warn("请先选择数据！！！");"copy"===e&&(_.value="",n.forEach((e=>{_.value+=`机器型号：${e.b_name}\r\n机身编码：${e.machine_id}\r\n原有故障：${e.r_o_fault}\r\n确认故障：${e.r_fault_desc}\r\n更换配件：${e.r_replace_part}\r\n价格：${e.r_price}\r\n\r\n`}))),"diliver"===e&&a("showDeliverModal",JSON.stringify(n))},copyData:_,handleCancel:function(){a("update:visible",!1)},handleOk:()=>{a("update:visible",!1)},onListdataSelect:e=>{i.value=e.reduce(((e,a)=>e+Number(a.r_price)),0)}}}}),qa=e=>(U("data-v-695e280b"),e=e(),z(),e),Ja={class:"form-table",cellspacing:"0",cellpadding:"0"},Ka=qa((()=>I("td",{class:"tdl tdl2_w"},"客户名称",-1))),Za={class:"tdc tdc2_w"},Ha=qa((()=>I("td",{class:"tdl tdl2_w"}," 联系方式 ",-1))),Qa={class:"tdc tdc2_w"},Wa=S(" 维修机列表 "),Xa=S(" 合计："),Ga=qa((()=>I("small",null,"￥",-1))),et=S(),at=S(" 元 "),tt={class:"tools"},lt=S(" 复制 "),nt=qa((()=>I("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[I("path",{d:"M957.152011 169.189354c0-35.162848-28.760021-63.814398-64.031339-63.814398l-500.744655 0c-35.272341 0-64.031339 28.65155-64.031339 63.814398l0 105.705484c0 1.735527-0.759293 3.146667-2.279926 3.90596l-176.736237 92.89983c-49.867758 26.155706-82.48155 77.488839-82.48155 133.813658l0 320.0472 133.867894 0c0 0.10847 0 0.10847 0 0.162706l1.194198 0c11.883655 53.123918 59.147098 92.89983 115.852588 92.89983s103.969956-39.775912 115.853611-92.89983l1.465374 0c0.054235-0.054235 0.054235-0.054235 0.054235-0.162706l150.311401 0c0 0.10847 0 0.10847 0 0.162706l5.426593 0c11.93789 53.123918 59.147098 92.89983 115.906823 92.89983 56.760748 0 104.078427-39.830147 115.907846-93.062536l134.465504 0L957.153034 169.189354zM317.761646 863.058494c-34.944883 0-63.380516-28.434609-63.380516-63.380516s28.434609-63.380516 63.380516-63.380516c34.945907 0 63.381539 28.434609 63.381539 63.380516S352.708576 863.058494 317.761646 863.058494zM706.77866 863.058494c-34.944883 0-63.379493-28.434609-63.379493-63.380516s28.433586-63.380516 63.379493-63.380516c34.945907 0 63.380516 28.434609 63.380516 63.380516S741.724567 863.058494 706.77866 863.058494zM901.585461 769.995959l-80.093153 0c-13.240559-51.225685-59.365062-89.264023-114.714671-89.264023-55.402821 0-101.58156 38.039361-114.821095 89.264023L432.530552 769.995959c-13.239536-51.225685-59.365062-89.264023-114.767883-89.264023-55.402821 0-101.527324 38.039361-114.76686 89.264023l-80.58127 0L122.414539 505.514285c0-35.108612 20.239973-67.503417 52.798507-84.650959l175.705767-92.356454c20.402679-10.148128 32.992415-30.713512 32.992415-53.613058L383.911228 169.189354c0-4.450359 3.90596-8.248871 8.464789-8.248871l500.744655 0c4.557806 0 8.464789 3.798513 8.464789 8.248871L901.585461 769.995959z","p-id":"4974"}),I("path",{d:"M372.460432 382.499577c-15.356756 0-27.782763 12.426007-27.782763 27.78174l0 138.91484L205.761805 549.196157c-15.356756 0-27.782763 12.42703-27.782763 27.782763s12.42703 27.782763 27.782763 27.782763l166.697603 0c15.356756 0 27.782763-12.42703 27.782763-27.782763L400.242172 410.282341C400.243195 394.925584 387.816165 382.499577 372.460432 382.499577z","p-id":"4975"})],-1))),it=S(" 发货 "),dt=qa((()=>I("span",null,null,-1))),rt=S("取 消 "),ot=S("确 定 ");var st=_(Ya,[["render",function(e,a,t,l,n,i){const d=w("a-divider"),r=w("a-col"),o=w("CopyOutlined"),s=w("a-button"),c=w("Icon"),u=w("a-row"),p=w("ListData"),_=w("CloseOutlined"),m=w("CheckOutlined"),h=w("ZwModal"),f=y("clipboard");return C(),M(h,B({visible:e.visible},e.$attrs),{footer:L((()=>[D(s,{key:"back",onClick:e.handleCancel},{icon:L((()=>[D(_)])),default:L((()=>[rt])),_:1},8,["onClick"]),D(s,{key:"submit",type:"primary",onClick:e.handleOk},{icon:L((()=>[D(m)])),default:L((()=>[ot])),_:1},8,["onClick"])])),default:L((()=>[I("table",Ja,[I("tr",null,[Ka,I("td",Za,O(e.formdata.c_name),1),Ha,I("td",Qa,O(e.formdata.c_phone),1)])]),D(d,{style:{"font-weight":"500",color:"#606266","font-size":"14px"}},{default:L((()=>[I("span",null,[Wa,I("b",null,"共 "+O(e.count)+" 台",1)])])),_:1}),D(u,{class:"tools-bar"},{default:L((()=>[D(r,{span:4},{default:L((()=>[Xa,Ga,et,I("b",null,O(e.sumPriceRef),1),at])),_:1}),D(r,{span:20},{default:L((()=>[I("div",tt,[R((C(),M(s,{onClick:a[0]||(a[0]=a=>e.handleToolsbarAction("copy",a))},{default:L((()=>[D(o),lt])),_:1})),[[f,e.copyData]]),2===e.isDeliverRef?(C(),M(s,{key:0,style:{"margin-left":"8px"},onClick:a[1]||(a[1]=a=>e.handleToolsbarAction("diliver",a))},{default:L((()=>[D(c,null,{component:L((()=>[nt])),_:1}),it])),_:1})):V("",!0)])])),_:1})])),_:1}),e.visible?(C(),M(p,{key:0,ref:"ListDataRefs",columns:e.columns,size:"small",bordered:"",rowKey:"r_id",apis:{query:"repair"},"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataLoaded:e.onListdataLoaded,onListdataSelect:e.onListdataSelect},{topTools:L((()=>[dt])),_:1},8,["columns","before-listdata-load","onListdataLoaded","onListdataSelect"])):V("",!0)])),_:1},16,["visible"])}],["__scopeId","data-v-695e280b"]]);const ct=f({name:"DeliverModal",props:{visible:{type:Boolean,default:!1},formdata:{type:Array,default:()=>[]},cid:{type:Number,default:null}},setup(e,{emit:a}){const t=v("context");b({tracking_num:"",delivery_date:""});const l=function(){a("update:visible",!1)},n=v("deliverSuccess");const i=b(!1);return{getBrand:e=>{const a=e?Number(e.split("-")[1]):null;return m(u.value,a)},getModel:e=>{if(0===e.length)return"";const a=e[e.length-1];return m(u.value,a)},handleCancel:l,submiting:i,handleOk:a=>{const d=e.formdata;if(!d&&d.length<=0)return t.$message.error("发货列表为空！");i.value=!0;const r={},o={};d.forEach((e=>{o.list||(o.list=[]),r.list||(r.list=[]);const a=e.r_relate_product,t=[],l=!c(a)&&Z(a)?JSON.parse(a):Y(a)?a:[];1!==e.r_is_repair||c(l)||(l.forEach((a=>{2!==a.isOut&&(a.io_num=a.num,a.o_type=1,a.o_state=1,a.r_id=e.r_id,a.isOut=2,t.push(a))})),r.list.push(...t)),r.mold=1,r.c_id=e["ro.c_id"],o.list.push({r_id:e.r_id,r_is_deliver:1,r_price:e.r_price,r_relate_product:t.length>0?t:l}),o.order=e.r_order}));const s={repair:o,io:r};1===a&&delete s.io,t.$http.post("repair/deliver",s).then((e=>{e.success?t.$modal.success({title:"发货成功！",content:"",zIndex:1009,onOk(){l(),n()}}):t.$message.error("发货失败！")})).catch((e=>{console.log(e)})).finally((()=>{i.value=!1}))},relateProductDeal:function(e){return e&&"string"==typeof e?JSON.parse(e):e}}}}),ut={style:{"margin-bottom":"unset"}},pt=I("small",null,"       x",-1),_t={key:0,class:"isout"},mt=I("span",null,"出库中...",-1),ht={key:1,class:"isout",style:{color:"green"}},ft=I("span",null,"已出库",-1),vt={key:2,class:"isout",style:{color:"orange"}},gt=I("span",null,"出库失败",-1),bt={key:3,class:"isout",style:{color:"gray"}},kt=I("span",null," 待出库 ",-1),wt=S("取 消 "),yt=S("发 货 "),Ct=S("发货并出库 ");var xt=_(ct,[["render",function(e,a,t,l,n,i){const d=w("a-table-column"),r=w("LoadingOutlined"),o=w("CheckCircleOutlined"),s=w("ExclamationCircleOutlined"),c=w("ClockCircleOutlined"),u=w("a-table"),p=w("CloseOutlined"),_=w("a-button"),m=w("CheckOutlined"),h=w("ZwModal");return C(),M(h,B({visible:e.visible},e.$attrs),{footer:L((()=>[D(_,{key:"back",onClick:e.handleCancel},{icon:L((()=>[D(p)])),default:L((()=>[wt])),_:1},8,["onClick"]),D(_,{key:"submit",type:"primary",onClick:a[0]||(a[0]=a=>e.handleOk(1)),loading:e.submiting},{icon:L((()=>[D(m)])),default:L((()=>[yt])),_:1},8,["loading"]),D(_,{key:"submit",type:"primary",onClick:a[1]||(a[1]=a=>e.handleOk(2)),loading:e.submiting},{icon:L((()=>[D(m)])),default:L((()=>[Ct])),_:1},8,["loading"])])),default:L((()=>[D(u,{dataSource:e.formdata,rowKey:"r_id",pagination:!1,bordered:"",size:"small"},{default:L((()=>[D(d,{width:45,"data-index":"index",title:"序号",align:"center"},{default:L((({index:e})=>[S(O(e+1),1)])),_:1}),D(d,{"data-index":"b_all_path",width:146,title:"品牌",align:"center"},{default:L((({record:a,text:t})=>[S(O(e.getBrand(t))+" - "+O(a.b_name),1)])),_:1}),D(d,{"data-index":"r_fault_desc",width:176,title:"确认故障",align:"center"}),D(d,{"data-index":"r_replace_part",width:126,title:"更换配件",align:"center"}),D(d,{"data-index":"r_relate_product",title:"关联产品"},{default:L((({text:a})=>[I("ol",ut,[(C(!0),x($,null,P(e.relateProductDeal(a),(a=>(C(),x("li",{key:a.p_id},[S(O(e.getBrand(a.b_all_path))+" - "+O(a.b_name||e.getModel(a.b_all_path.split("-")))+" - "+O(a.f_name)+" ",1),pt,S(O(a.num)+" ",1),1==a.isOut?(C(),x("span",_t,[D(r),mt])):2==a.isOut?(C(),x("small",ht,[D(o),ft])):3==a.isOut?(C(),x("small",vt,[D(s),gt])):(C(),x("small",bt,[D(c),kt]))])))),128))])])),_:1})])),_:1},8,["dataSource"])])),_:1},16,["visible"])}]]);const It=f({name:"LogisticsAdd",props:{visible:{type:Boolean,default:!1},selectedRows:{type:Array,default:()=>[]}},setup(e,{emit:o}){const s=v("context"),c=b(null),u=b(null),p=b({logistics_num:"",logistics_name:""}),_=function(){o("update:visible",!1)};return{modal:c,logisticsForm:u,formdata:p,handleCancel:_,handleOk:()=>r(this,null,(function*(){try{const p=yield u.value.validate();console.log(p),console.log(e.selectedRows),s.$http.post("repair/updateLogistics",(r=((e,a)=>{for(var t in a||(a={}))n.call(a,t)&&d(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&d(e,t,a[t]);return e})({},p),o={ids:e.selectedRows.map((e=>e.r_id))},a(r,t(o)))).then((e=>{e.success?(s.$message.success(e.message),setTimeout(_,500)):s.$message.error(e.message)})).catch((e=>{console.log(e),s.$message.error(e)})).finally((()=>{c.value.submiting=!1}))}catch(p){c.value.submiting=!1}var r,o})),columns:[{title:"姓名",dataIndex:"c_name",width:106,align:"center"},{title:"型号",dataIndex:"b_name",width:96,align:"center"},{title:"是否维修",dataIndex:"r_is_repair",key:"r_is_repair",width:96,align:"center",customRender:ne},{title:"维修状态",dataIndex:"r_repair_status",key:"r_repair_status",width:96,align:"center",customRender:ie},{title:"发货",dataIndex:"r_is_deliver",width:62,align:"center",customRender:de},{title:"物流名称",dataIndex:"logistics_name",align:"center"},{title:"物流单号",dataIndex:"logistics_num",align:"center"}]}}});const Dt=f({name:"MaintainList",components:{FormModal:Sa,ClientRepairList:st,DeliverModal:xt,LogisticsAdd:_(It,[["render",function(e,a,t,l,n,i){const d=w("a-table"),r=w("a-divider"),o=w("a-input"),s=w("a-form-item"),c=w("a-form"),u=w("ZwModal");return C(),M(u,B({ref:"modal",visible:e.visible},e.$attrs,{onSubmit:e.handleOk}),{default:L((()=>[D(d,{dataSource:e.selectedRows,columns:e.columns,pagination:!1,size:"small"},null,8,["dataSource","columns"]),D(r),D(c,{ref:"logisticsForm",model:e.formdata,name:"logisticsForm","label-col":{span:5},"wrapper-col":{span:17}},{default:L((()=>[D(s,{label:"物流名称",name:"logistics_name",rules:[{required:!0,message:"Please input your 物流名称"}]},{default:L((()=>[D(o,{value:e.formdata.logistics_name,"onUpdate:value":a[0]||(a[0]=a=>e.formdata.logistics_name=a)},null,8,["value"])])),_:1}),D(s,{label:"物流号",name:"logistics_num",rules:[{required:!0,message:"Please input your 物流号"}]},{default:L((()=>[D(o,{value:e.formdata.logistics_num,"onUpdate:value":a[1]||(a[1]=a=>e.formdata.logistics_num=a)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},16,["visible","onSubmit"])}]])},props:{topTools:{type:Object,default:()=>({})},pageMode:{type:String,default:"total"}},setup(e){const a=v("context"),t=b(null),l=()=>{t.value.handleReload()},n=E({r_is_repair:null,r_repair_status:null,c_id:null,timeRange:null}),i=b(!1),d=b(!1),s=b(null),u=b(!1),p=b([]),_=e=>{u.value=!0,p.value=JSON.parse(e)};H("onDMShow",_);const m=()=>r(this,null,(function*(){d.value&&(yield s.value.refresh()),l(),i.value=!1}));H("reload",m);const f=E({mode:"add",record:{}}),g=Na[`${e.pageMode}Columns`]({clientCellClick:e=>{f.record=e,d.value=!0},customCellClick:e=>{f.mode="editSingle",f.record=e,i.value=!0},colInputBlur(e){a.$http.put("repair/"+e.order,{order:e.order,list:[{r_id:e.id,[e.fields]:e.value}]}).then((e=>{a.$message.success(e.message),l()}))},reload(){l()}});H("deliverSuccess",(function(){i.value=!1,d.value=!1,l()}));const k=b([]),w=b(!1);return{listdata:t,modalVisible:i,columns:g,ClientRepairList:s,crlVisible:d,formData:f,dmVisible:u,dmFormData:p,onDeliverModalVisible:_,beforeListdataLoad:a=>{"todo"===e.pageMode?a.deliver=2:"done"==e.pageMode&&(a.deliver=1),Object.keys(n).forEach((e=>{"timeRange"===e&&(!c(n[e])&&Y(n[e])?(n[e][0]&&(n.start=o(n[e][0]).format("YYYY-MM-DD")+" 00:00:00"),n[e][1]&&(n.end=o(n[e][1]).format("YYYY-MM-DD")+" 23:59:59")):(delete n.start,delete n.end))})),Object.assign(a,n)},beforeFormOpen:(e,a,t)=>(f.mode=e,f.record=a,i.value=!0,!1),reload:m,clientListEditEvent:({record:e})=>{f.mode="editSingle",f.record=e,i.value=!0},appendSearch:n,handleReload:l,handleRowEdit:(e,a)=>{t.value.handleAction.edit(e,a)},handleRowDel:e=>{t.value.handleAction.del(e)},selectedRows:k,onListdataSelect:e=>{k.value=e},showAddLogisticsInfoDialog:()=>{w.value=!0},logisticsDialogVisible:w,staffData:h}}}),Lt=S("同意"),St=S("拒绝"),Ot=S("已维修"),Mt=S("维修中"),Rt=S("原机返"),$t=S(" 物流信息 ");var Pt=_(Dt,[["render",function(e,a,t,l,n,i){const d=w("a-select-option"),r=w("a-select"),o=w("a-range-picker"),s=w("a-button"),c=w("FormModal"),u=w("EditFilled"),p=w("a-tooltip"),_=w("DeleteTwoTone"),m=w("a-space"),h=w("ListData"),f=w("ClientRepairList"),v=w("DeliverModal"),g=w("LogisticsAdd"),b=w("ZwScrollbar");return C(),M(b,{"wrap-class":"pd-17"},{default:L((()=>[D(h,{ref:"listdata",rowKey:"r_id",columns:e.columns,apis:"repair","top-tools":e.topTools,"before-form-open":e.beforeFormOpen,"before-listdata-load":e.beforeListdataLoad,"can-select":!0,onListdataSelect:e.onListdataSelect},Q({modal:L((()=>[D(c,{visible:e.modalVisible,"onUpdate:visible":a[4]||(a[4]=a=>e.modalVisible=a),"form-data":e.formData,width:1020,"mask-closable":!1,"z-index":1002,onListreload:e.reload},null,8,["visible","form-data","onListreload"])])),action:L((a=>[W(e.$slots,"action",G(ee(a)),(()=>[D(m,{size:2},{default:L((()=>[D(p,{title:"编辑","mouseLeave-delay":0},{default:L((()=>[D(s,{type:"link",size:"small",onClick:X((t=>e.handleRowEdit(a.record,a.index)),["stop"])},{icon:L((()=>[D(u)])),_:2},1032,["onClick"])])),_:2},1024),D(p,{title:"删除","mouseLeave-delay":0},{default:L((()=>[D(s,{type:"link",size:"small",onClick:X((t=>e.handleRowDel(a.record)),["stop"])},{icon:L((()=>[D(_,{twoToneColor:"#ff4d4f"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)]),!0)])),_:2},["done"!==e.pageMode?{name:"append-search",fn:L((()=>[D(r,{value:e.appendSearch.r_is_repair,"onUpdate:value":a[0]||(a[0]=a=>e.appendSearch.r_is_repair=a),name:"r_is_repair",placeholder:"是否维修",allowClear:"",onChange:e.handleReload},{default:L((()=>[D(d,{value:1},{default:L((()=>[Lt])),_:1}),D(d,{value:2},{default:L((()=>[St])),_:1})])),_:1},8,["value","onChange"]),D(r,{value:e.appendSearch.r_repair_status,"onUpdate:value":a[1]||(a[1]=a=>e.appendSearch.r_repair_status=a),name:"r_repair_status",placeholder:"维修状态",allowClear:"",onChange:e.handleReload},{default:L((()=>[D(d,{value:1},{default:L((()=>[Ot])),_:1}),D(d,{value:2},{default:L((()=>[Mt])),_:1}),D(d,{value:3},{default:L((()=>[Rt])),_:1})])),_:1},8,["value","onChange"]),"total"===e.pageMode?(C(),M(r,{key:0,value:e.appendSearch.c_id,"onUpdate:value":a[2]||(a[2]=a=>e.appendSearch.c_id=a),name:"c_id",placeholder:"客户姓名","show-search":"",allowClear:"","option-filter-prop":"title",onChange:e.handleReload},{default:L((()=>[(C(!0),x($,null,P(e.staffData,(e=>(C(),M(d,{key:e.c_id,value:e.c_id,title:e.c_name},{default:L((()=>[S(O(e.c_name),1)])),_:2},1032,["value","title"])))),128))])),_:1},8,["value","onChange"])):V("",!0),"total"===e.pageMode?(C(),M(o,{key:1,name:"timeRange",value:e.appendSearch.timeRange,"onUpdate:value":a[3]||(a[3]=a=>e.appendSearch.timeRange=a)},null,8,["value"])):V("",!0),D(s,{disabled:e.selectedRows.length<=0,onClick:e.showAddLogisticsInfoDialog},{default:L((()=>[$t])),_:1},8,["disabled","onClick"])]))}:void 0]),1032,["columns","top-tools","before-form-open","before-listdata-load","onListdataSelect"]),D(f,{ref:"ClientRepairList",visible:e.crlVisible,"onUpdate:visible":a[5]||(a[5]=a=>e.crlVisible=a),title:"客户维修机列表",formdata:e.formData.record||{},width:1280,"mask-closable":!1,onShowDeliverModal:e.onDeliverModalVisible,onShowFormModal:e.clientListEditEvent,"z-index":99},null,8,["visible","formdata","onShowDeliverModal","onShowFormModal"]),D(v,{visible:e.dmVisible,"onUpdate:visible":a[6]||(a[6]=a=>e.dmVisible=a),title:"发货机列表",formdata:e.dmFormData,"onUpdate:formdata":a[7]||(a[7]=a=>e.dmFormData=a),width:930,"mask-closable":!1,"z-index":1003},null,8,["visible","formdata"]),D(g,{visible:e.logisticsDialogVisible,"onUpdate:visible":a[8]||(a[8]=a=>e.logisticsDialogVisible=a),title:"批量添加物流信息",width:930,"selected-rows":e.selectedRows},null,8,["visible","selected-rows"])])),_:3})}],["__scopeId","data-v-9c645ed2"]]);export{Pt as M};
